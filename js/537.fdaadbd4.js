"use strict";(self["webpackChunkcrystal_dapp"]=self["webpackChunkcrystal_dapp"]||[]).push([[537],{39557:(e,t,l)=>{l.r(t),l.d(t,{default:()=>fe});var o=l(59835),a=l(86970);const n=e=>((0,o.dD)("data-v-562bfd19"),e=e(),(0,o.Cn)(),e),s={class:"q-pa-md",style:{"max-width":"1439px"}},r={style:{height:"36px"}},i={class:"float-left"},c={class:"float-right"},u={class:"float-right"},d={class:"row items-center no-wrap"},f={class:"text-center"},m={key:0,class:"row content-start min-width-320 gem-box"},p=["onClick"],v={class:"my-table-details",style:{"padding-left":"0px"}},w=["onClick"],g={class:"my-table-details text-h7"},h={class:"my-table-details text-h7"},y={class:"my-table-details text-h7"},b=n((()=>(0,o._)("span",{class:"text-h6 q-ml-sm"},"Incorrect blockchain",-1))),k=n((()=>(0,o._)("span",{class:"q-ml-sm"},"You are currently not connected to the correct network.",-1)));function _(e,t,l,n,_,q){const C=(0,o.up)("q-icon"),I=(0,o.up)("q-btn-toggle"),S=(0,o.up)("q-btn"),W=(0,o.up)("CrystalGem"),x=(0,o.up)("q-item-section"),G=(0,o.up)("q-item-label"),U=(0,o.up)("q-chip"),R=(0,o.up)("q-item"),Z=(0,o.up)("q-list"),N=(0,o.up)("q-btn-dropdown"),Q=(0,o.up)("q-th"),D=(0,o.up)("q-tr"),A=(0,o.up)("q-td"),H=(0,o.up)("q-table"),T=(0,o.up)("q-card"),z=(0,o.up)("q-tab-panel"),E=(0,o.up)("q-tab-panels"),P=(0,o.up)("nft-menu"),F=(0,o.up)("q-avatar"),M=(0,o.up)("q-space"),O=(0,o.up)("q-card-section"),j=(0,o.up)("q-card-actions"),B=(0,o.up)("q-dialog"),V=(0,o.up)("q-page"),$=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(V,{class:"row items-center justify-evenly bg-pic",style:{"padding-top":"58px"}},{default:(0,o.w5)((()=>[(0,o._)("div",s,[(0,o.Wm)(E,{class:"bg-none",flat:"","model-value":"collection",animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(z,{name:"collection",class:"q-pa-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",i,[(0,o.Wm)(I,{modelValue:e.isStashGrid,"onUpdate:modelValue":t[0]||(t[0]=t=>e.isStashGrid=t),flat:"",dense:"","toggle-color":"white",color:"grey",options:[{value:!0,slot:"one"},{value:!1,slot:"two"}]},{one:(0,o.w5)((()=>[(0,o.Wm)(C,{right:"",name:"view_module"})])),two:(0,o.w5)((()=>[(0,o.Wm)(C,{right:"",name:"view_list"})])),_:1},8,["modelValue"])]),(0,o._)("div",c,[(0,o.Wm)(S,{flat:"",round:"",dense:"",color:"white",icon:"las la-sync",onClick:t[1]||(t[1]=t=>e.getUserGems())})]),(0,o._)("div",u,[(0,o.Wm)(N,{flat:"",dense:"",onClick:t[3]||(t[3]=t=>e.setSample())},{label:(0,o.w5)((()=>[(0,o._)("div",d,[(0,o.Wm)(C,{left:"",name:"las la-award"}),(0,o._)("div",f,(0,a.zw)(e.$t("gems.rarity")),1)])])),default:(0,o.w5)((()=>[(0,o.Wm)(S,{flat:"",color:"white",label:"Change Color",class:"full-width",onClick:t[2]||(t[2]=t=>e.setSampleColor())}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.sample,(t=>((0,o.wg)(),(0,o.j4)(Z,{dense:"",key:t,class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o.wy)(((0,o.wg)(),(0,o.j4)(R,{clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{nft:t.nft,level:t.level,color:t.color,quality:t.quality,scale:.5,newGem:!0,size:50,detail:!1},null,8,["nft","level","color","quality","scale"])])),_:2},1024),(0,o.Wm)(x,null,{default:(0,o.w5)((()=>[(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o._)("div",{class:(0,a.C_)(e.getRarity(t.level).rarity)},(0,a.zw)(e.$t("gems.levels."+t.level)+e.$t("gems.names."+t.color)),3)])),_:2},1024),(0,o.Wm)(G,{caption:""},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,a.zw)(e.$t("gems."+e.getRarity(t.level).rarity)+" "+e.$t("gems.gem")+" ")+" "+(0,a.zw)(Math.floor(100/Math.pow(2,t.level+1)*1e4)/1e4)+"% ",1)])),_:2},1024)])),_:2},1024),(0,o.Wm)(x,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(U,{dense:""},{default:(0,o.w5)((()=>[(0,o._)("a",{class:(0,a.C_)(e.getRarity(t.level).rarity)},(0,a.zw)(e.getRarity(t.level).short),3)])),_:2},1024)])),_:2},1024)])),_:2},1024)),[[$]])])),_:2},1024)))),128))])),_:1})])]),e.isStashGrid?((0,o.wg)(),(0,o.iD)("div",m,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.newGems,(l=>((0,o.wg)(),(0,o.iD)("div",{class:"gem-in-box",key:l,onClick:t[4]||(t[4]=t=>e.getUserGems())},[(0,o.Wm)(W,{nft:l.nft,level:l.level,color:l.color,quality:l.quality,text:"?",scale:l.scale,newGem:!0,size:50,detail:!1},null,8,["nft","level","color","quality","scale"])])))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.userGems,(t=>((0,o.wg)(),(0,o.iD)("div",{class:"gem-in-box",key:t,onClick:l=>e.gemSelected(t.nft)},[(0,o.Wm)(W,{nft:t.nft,level:t.level,color:t.color,quality:t.quality,scale:t.scale,size:50,detail:!0,owner:!0,approve:!0},null,8,["nft","level","color","quality","scale"])],8,p)))),128))])):((0,o.wg)(),(0,o.j4)(H,{key:1,dense:e.$q.screen.lt.xs,"virtual-scroll":"","rows-per-page-options":[25],class:"my-sticky-header-table bg-none",rows:e.userGems,columns:e.gemColumns,"row-key":"nft",style:{"text-shadow":"#000 1px 0 10px"}},{header:(0,o.w5)((t=>[(0,o.Wm)(D,{props:t},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols,(l=>((0,o.wg)(),(0,o.j4)(Q,{key:l.name,props:t,class:"text-primary text-justify"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(""==l.label?"":e.$t("gems."+l.label)),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),"body-cell-nft":(0,o.w5)((t=>[(0,o.Wm)(A,{props:t},{default:(0,o.w5)((()=>[(0,o._)("div",v,[(0,o._)("div",{onClick:l=>e.gemSelected(t.row.nft)},[(0,o.Wm)(W,{nft:t.row.nft,level:t.row.level,color:t.row.color,quality:t.row.quality,scale:t.row.scale,size:50,detail:!0,owner:!0,names:!0,approve:!0},null,8,["nft","level","color","quality","scale"])],8,w)])])),_:2},1032,["props"])])),"body-cell-scale":(0,o.w5)((e=>[(0,o.Wm)(A,{props:e},{default:(0,o.w5)((()=>[(0,o._)("div",g,(0,a.zw)(parseInt(100*e.row.scale)),1)])),_:2},1032,["props"])])),"body-cell-level":(0,o.w5)((e=>[(0,o.Wm)(A,{props:e},{default:(0,o.w5)((()=>[(0,o._)("div",h,(0,a.zw)(parseInt(4*e.row.level+10)),1)])),_:2},1032,["props"])])),"body-cell-quality":(0,o.w5)((e=>[(0,o.Wm)(A,{props:e},{default:(0,o.w5)((()=>[(0,o._)("div",y,(0,a.zw)(e.row.quality),1)])),_:2},1032,["props"])])),_:1},8,["dense","rows","columns"]))])),_:1})])),_:1})])),_:1})]),(0,o.Wm)(P),(0,o.Wm)(B,{modelValue:e.switchNet,"onUpdate:modelValue":t[6]||(t[6]=t=>e.switchNet=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o.Wm)(O,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(F,{icon:"signal_wifi_off",color:"primary","text-color":"white",size:"xs"}),b,(0,o.Wm)(M),(0,o.wy)((0,o.Wm)(S,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])])),_:1}),(0,o.Wm)(O,{class:"row items-center"},{default:(0,o.w5)((()=>[k])),_:1}),(0,o.Wm)(j,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(S,{class:"full-width",label:"Switch",color:"primary",onClick:t[5]||(t[5]=t=>e.switchNetwork(e.netIndex))},null,512),[[$]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var q=l(60499),C=l(19302),I=l(65457),S=l(43380),W=l(9229),x=l(85990),G=l(88576),U=l.n(G),R=l(17779),Z=function(e,t,l,o){function a(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,n){function s(e){try{i(o.next(e))}catch(t){n(t)}}function r(e){try{i(o["throw"](e))}catch(t){n(t)}}function i(e){e.done?l(e.value):a(e.value).then(s,r)}i((o=o.apply(e,t||[])).next())}))},N=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,l=e[Symbol.asyncIterator];return l?l.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(l){t[l]=e[l]&&function(t){return new Promise((function(o,n){t=e[l](t),a(o,n,t.done,t.value)}))}}function a(e,t,l,o){Promise.resolve(o).then((function(t){e({value:t,done:l})}),t)}};const Q=l(10875);function D(e){R.log("Switch network: ",(0,x.v)().networks[e].name,(0,x.v)().networks[e].id),(0,x.v)().initWeb3(e)}const A={title:"Crystal - NFT"},H=[{name:"nft",label:"itemName",field:"nft",align:"left",sortable:!0,headerStyle:"text-align: center;"},{name:"level",label:"level",field:"level",align:"left",sortable:!0},{name:"scale",label:"weight",field:"scale",align:"left",sortable:!0},{name:"quality",label:"quality",field:"quality",align:"left",sortable:!0}],T=(0,o.aZ)({name:"NftListPage",components:{CrystalGem:S.Z,NftMenu:W.Z},setup(){const e=(0,C.Z)();e.dark.set(!0),(0,I.Z)(A);const t=e=>new Promise((t=>setTimeout(t,e))),l=(0,q.iH)(!1),o=(0,q.iH)(0),a="polygon",n=(0,q.iH)("0xf18a1FEf4823Ce5ddb20B71D82FA06470DF84B17"),s=(0,q.iH)("0x30a8C517b35e7D635f77AaeeBb0C704015dFaa6A"),r=(0,q.iH)([]),i=(0,q.iH)(0),c=(0,q.iH)([]),u=(0,q.iH)([]);let d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function f(e){let t="Common",l="C";switch(e){case 4:case 5:case 6:case 7:l="UC";break;case 8:case 9:l="R";break;case 10:l="RR";break;case 11:l="RRR";break;case 12:l="SR";break;case 13:l="HR";break;case 14:l="UR";break;case 15:l="SSR";break;default:break}switch(e){case 4:case 5:case 6:case 7:t="Uncommon";break;case 8:case 9:case 10:case 11:t="Rare";break;case 12:case 13:case 14:case 15:t="Epic";break;default:break}return{rarity:t,short:l}}function m(){return Z(this,void 0,void 0,(function*(){const e=yield(0,x.v)().web3.eth.net.getId().then((e=>(R.log(e),e))).catch((e=>(R.log("checkNetwork: ",e),-1)));return e}))}function p(e){return Z(this,void 0,void 0,(function*(){const t=(0,x.v)().networks[e].id,l=(0,x.v)().networks[e].name,o=(0,x.v)().networks[e].tokenName,a=(0,x.v)().networks[e].symbol,n=(0,x.v)().networks[e].rpcUrl,s=(0,x.v)().networks[e].explorer,r="0x"+t.toString(16);if("undefined"!==typeof window.ethereum)try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:r}]}),location.reload()}catch(i){if(R.log(i),4902===i.code){R.log("Add Chain");try{yield window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:r,chainName:l,nativeCurrency:{name:o,symbol:a,decimals:18},rpcUrls:[n],blockExplorerUrls:[s]}]}),location.reload()}catch(c){alert(c.message)}}else alert(i.message)}}))}function v(e){return Z(this,void 0,void 0,(function*(){R.log("reSyncURI:",e);const t=yield U().Web3API.token.reSyncMetadata({chain:a,address:s.value,token_id:e,flag:"uri"});R.log("reSyncURI resp:",e,t)}))}function w(e){var l,o,a,n;return Z(this,void 0,void 0,(function*(){try{for(l=N(e);o=yield l.next(),!o.done;){const e=o.value;yield t(1e3),yield v(e),yield g(e)}}catch(s){a={error:s}}finally{try{o&&!o.done&&(n=l.return)&&(yield n.call(l))}finally{if(a)throw a.error}}}))}function g(e){return Z(this,void 0,void 0,(function*(){R.log("getGemURI id:",e);const t=(0,x.v)().web3Instance,l=new t.eth.Contract(Q,s.value);l.methods.tokenURI(e).call().then((function(t){if(!t.length)return void R.log("getGemURI length: ",t.length);R.log("getGemURI: ",t);const l=parseInt(e),o=JSON.parse(t),a=(0,x.v)().web3.utils.toHex(o.properties);let n=10,s=10;for(let e=2;e<14;e++){const t=parseInt(a[e],16);e<8?n+=t:e<14&&(s+=t)}const r={nft:l,level:o.level,color:o.color,quality:n,scale:s/100,properties:a};for(let e=0;e<u.value.length;e++){const t=u.value[e];t.nft==l&&u.value.splice(e,1)}k(r,l)})).catch((function(e){R.log("getGemURI: ",e)}))}))}function h(){var e;return Z(this,void 0,void 0,(function*(){const l="https://g19udojubwks.usemoralis.com:2053/server",o="P749qSdfiW93rIsFAtUSWNAnJK4HX8hyvauadRFz";yield U().start({serverUrl:l,appId:o});const a=(0,x.v)().account,n=(0,x.v)().web3Instance;if(!n.utils.isAddress(a))return alert("Need Connect Wallet!"),void R.log("Not Address:",a);const r={chain:"polygon",address:a,token_address:s.value};try{let l=yield U().Web3API.account.getNFTsForContract(r);const o=l.result||[];while(l.next){if(l=yield l.next(),0==(null===(e=null===l||void 0===l?void 0:l.result)||void 0===e?void 0:e.length))break;o.push(...l.result||[])}R.log(o),S(o);let a=[];u.value=[],o.forEach((e=>{const t=parseInt(e.token_id);if(e.token_uri){const l=JSON.parse(e.token_uri),o=(0,x.v)().web3.utils.toHex(l.properties);let a=10,n=10;for(let e=2;e<14;e++){const t=parseInt(o[e],16);e<8?a+=t:e<14&&(n+=t)}const s={nft:t,level:l.level,color:l.color,quality:a,scale:n/100,properties:o};k(s,t)}else{const l={nft:t,level:8,color:0,quality:10,scale:1,properties:"0xffffffffffff"};a.push(e.token_id);let o=!1;for(let e=0;e<c.value.length;e++){const l=c.value[e];if(l.nft==t){o=!0;break}}o||(u.value.unshift(l),R.log(l))}})),w(a),yield t(500)}catch(i){R.log(i)}}))}function y(){return Z(this,void 0,void 0,(function*(){const e=(0,x.v)().web3Instance,t=(0,x.v)().account;if(!e.utils.isAddress(t))return void R.log("Not Address:",t);const l=new e.eth.Contract(Q,s.value);let o=[],a={filter:{to:t},fromBlock:28423538};yield l.getPastEvents("Transfer",a).then((function(e){R.log("Transfer Events:",e),e.forEach((e=>{if(!e.removed){let t=e.returnValues.tokenId;b(t),o.push(t)}}))})).catch((e=>{R.error("getUserGemTransfer Error:",e)})),R.log("ALL ID:",o)}))}function b(e){return Z(this,void 0,void 0,(function*(){R.log("getGemOwner id:",e);const t=(0,x.v)().web3Instance,l=(0,x.v)().account,o=new t.eth.Contract(Q,s.value);o.methods.ownerOf(e).call().then((function(t){t.length?t.toUpperCase()!=l.toUpperCase()&&_(e):R.log("getGemOwner length: ",t.length)})).catch((function(e){R.log("getGemOwner: ",e)}))}))}function k(e,t){let l=!1;for(let o=0;o<c.value.length;o++){const e=c.value[o];if(e.nft==t){l=!0;break}}l||(c.value.unshift(e),R.log(e))}function _(e){for(let t=0;t<c.value.length;t++){const l=c.value[t];if(l.nft==e){c.value.splice(t,1);break}}}function S(e){let t=[];for(let l=0;l<c.value.length;l++){const o=c.value[l];for(let l=0;l<e.length;l++){const a=e[l].token_id;a==o.nft&&t.push(o)}}c.value=t}function W(){r.value=[];for(let e=0;e<16;e++){const t={nft:0,level:e%16,color:i.value%6,quality:100,scale:1,properties:"0x123123123123123123123"};r.value.unshift(t)}R.log("sample",r.value[0])}function G(){i.value++,W()}function T(){let e=0;for(let l=0;l<1e6;l++){let t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);t=Math.floor(t/10);let l=0;for(let o=0;o<16;o++){if(t%2==0){l=o,e++;break}t=Math.floor(t/10)}d[l]++}R.log("gems:",d);let t=0;for(let l=0;l<d.length;l++){const e=d[l];t+=e}R.log(e,t)}return{isStashGrid:(0,q.iH)(!0),netIndex:o,chain:a,switchNet:l,memberContract:n,gemNftContract:s,sample:r,sampleColor:i,userGems:c,newGems:u,gemColumns:H,checkNetwork:m,switchNetwork:p,reSyncURI:v,reSyncURIs:w,getGemURI:g,getUserGems:h,getUserGemTransfer:y,getGemOwner:b,addGem:k,removeGem:_,compareGem:S,setSample:W,setSampleColor:G,test:T,getRarity:f,initGame(){return Z(this,void 0,void 0,(function*(){let e=new URLSearchParams(window.location.search),t=e.get("ref");R.log(t||"No Ref");const a=o.value;D(a);const n=yield m();if(n!=(0,x.v)().networks[a].id)return R.log(n,"!=",(0,x.v)().networks[a].id),void(l.value=!0)}))},updateInputs(e){R.log("updateInputs: ",e)},gemSelected(e){R.log("Selected: ",e),b(e)},initDate(){localStorage.getItem((0,x.v)().account.concat("-userGems"))&&(Object.assign(c.value,JSON.parse(localStorage.getItem((0,x.v)().account.concat("-userGems"))||"")),c.value.sort((function(e,t){return e.nft<t.nft?1:e.nft>t.nft?-1:0})))},storeData(){R.log("storeData: userGems"),localStorage.setItem((0,x.v)().account.concat("-userGems"),JSON.stringify(c.value))}}},beforeMount(){this.initDate(),this.initGame(),this.getUserGems()},beforeUnmount(){this.storeData()}});var z=l(11639),E=l(69885),P=l(89800),F=l(84106),M=l(44458),O=l(1389),j=l(22857),B=l(68879),V=l(32045),$=l(13246),L=l(490),J=l(76749),K=l(33115),Y=l(57691),X=l(8858),ee=l(31233),te=l(21682),le=l(67220),oe=l(32074),ae=l(63190),ne=l(61357),se=l(90136),re=l(11821),ie=l(62146),ce=l(69984),ue=l.n(ce);const de=(0,z.Z)(T,[["render",_],["__scopeId","data-v-562bfd19"]]),fe=de;ue()(T,"components",{QPage:E.Z,QTabPanels:P.Z,QTabPanel:F.Z,QCard:M.Z,QBtnToggle:O.Z,QIcon:j.Z,QBtn:B.Z,QBtnDropdown:V.Z,QList:$.Z,QItem:L.Z,QItemSection:J.Z,QItemLabel:K.Z,QChip:Y.Z,QTable:X.Z,QTr:ee.Z,QTh:te.Z,QTd:le.Z,QDialog:oe.Z,QCardSection:ae.Z,QAvatar:ne.Z,QSpace:se.Z,QCardActions:re.Z}),ue()(T,"directives",{ClosePopup:ie.Z})}}]);
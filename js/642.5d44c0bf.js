"use strict";(self["webpackChunkcrystal_dapp"]=self["webpackChunkcrystal_dapp"]||[]).push([[642],{58005:(e,t,l)=>{l.r(t),l.d(t,{default:()=>oe});var o=l(59835),n=l(86970);const a=e=>((0,o.dD)("data-v-8c7ebc48"),e=e(),(0,o.Cn)(),e),r={class:"q-pa-md",style:{"max-width":"1439px"}},s=a((()=>(0,o._)("div",{class:"text-h6 text-center"},"Comming Soon...",-1))),i=a((()=>(0,o._)("br",null,null,-1))),c={class:"row items-center justify-evenly"},u={class:"gem-box row items-center justify-evenly"},f=a((()=>(0,o._)("div",{class:"text-h6"},[(0,o._)("i",{class:"las la-plus"})],-1))),m={class:"gem-box row items-center justify-evenly"},d=a((()=>(0,o._)("div",{class:"text-h6"},[(0,o._)("i",{class:"las la-plus"})],-1))),v={class:"gem-box row items-center justify-evenly"},p=a((()=>(0,o._)("div",{class:"row items-center justify-evenly"},[(0,o._)("i",{class:"las la-angle-double-down"})],-1))),w={class:"row items-center justify-evenly"},y=a((()=>(0,o._)("br",null,null,-1))),g=a((()=>(0,o._)("div",{class:"text-center"},null,-1))),h=a((()=>(0,o._)("br",null,null,-1))),b=(0,o.Uk)(" Combine "),k=a((()=>(0,o._)("span",{class:"text-h6 q-ml-sm"},"Incorrect blockchain",-1))),_=a((()=>(0,o._)("span",{class:"q-ml-sm"},"You are currently not connected to the correct network.",-1))),G=(0,o.Uk)(" Choose a Target "),q=["onClick"],x={class:"gem-count text-right text-bold"};function C(e,t,l,a,C,I){const S=(0,o.up)("CrystalGem"),W=(0,o.up)("q-btn"),N=(0,o.up)("q-tab-panel"),T=(0,o.up)("q-tab-panels"),U=(0,o.up)("nft-menu"),Z=(0,o.up)("q-avatar"),H=(0,o.up)("q-space"),D=(0,o.up)("q-card-section"),P=(0,o.up)("q-card-actions"),j=(0,o.up)("q-card"),Q=(0,o.up)("q-dialog"),A=(0,o.up)("q-page"),z=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(A,{class:"row items-center justify-evenly bg-pic",style:{"padding-top":"58px"}},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o.Wm)(T,{class:"",flat:"","model-value":"crafting",animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(N,{class:"",name:"crafting"},{default:(0,o.w5)((()=>[s,i,(0,o._)("div",c,[(0,o._)("div",u,[e.fromGem1?((0,o.wg)(),(0,o.iD)("div",{key:e.fromGem1},[(0,o.Wm)(S,{nft:e.fromGem1.nft,level:e.fromGem1.level,color:e.fromGem1.color,quality:e.fromGem1.quality,scale:e.fromGem1.scale,size:36,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,o.kq)("",!0)]),f,(0,o._)("div",m,[e.fromGem2?((0,o.wg)(),(0,o.iD)("div",{key:e.fromGem2},[(0,o.Wm)(S,{nft:e.fromGem2.nft,level:e.fromGem2.level,color:e.fromGem2.color,quality:e.fromGem2.quality,scale:e.fromGem2.scale,size:36,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,o.kq)("",!0)]),d,(0,o._)("div",v,[e.fromGem3?((0,o.wg)(),(0,o.iD)("div",{key:e.fromGem3},[(0,o.Wm)(S,{nft:e.fromGem3.nft,level:e.fromGem3.level,color:e.fromGem3.color,quality:e.fromGem3.quality,scale:e.fromGem3.scale,size:36,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,o.kq)("",!0)])]),p,(0,o._)("div",w,[(0,o._)("div",{class:"gem-box row items-center justify-evenly",onClick:t[0]||(t[0]=t=>e.updateTree())},[e.toCombineGem?((0,o.wg)(),(0,o.iD)("div",{key:e.toCombineGem},[(0,o.Wm)(S,{nft:1,level:e.toCombineGem.level,color:e.toCombineGem.color,quality:32,scale:1,size:45},null,8,["level","color"])])):(0,o.kq)("",!0)])]),y,g,h,(0,o.Wm)(W,{disable:"",unelevated:"",color:"primary",class:"min-width-320","no-caps":""},{default:(0,o.w5)((()=>[b])),_:1})])),_:1})])),_:1})]),(0,o.Wm)(U),(0,o.Wm)(Q,{modelValue:e.switchNet,"onUpdate:modelValue":t[2]||(t[2]=t=>e.switchNet=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(j,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(Z,{icon:"signal_wifi_off",color:"primary","text-color":"white",size:"xs"}),k,(0,o.Wm)(H),(0,o.wy)((0,o.Wm)(W,{icon:"close",flat:"",round:"",dense:""},null,512),[[z]])])),_:1}),(0,o.Wm)(D,{class:"row items-center"},{default:(0,o.w5)((()=>[_])),_:1}),(0,o.Wm)(P,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(W,{class:"full-width",label:"Switch",color:"primary",onClick:t[1]||(t[1]=t=>e.switchNetwork(e.netIndex))},null,512),[[z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(Q,{modelValue:e.chooseTar,"onUpdate:modelValue":t[3]||(t[3]=t=>e.chooseTar=t)},{default:(0,o.w5)((()=>[(0,o.Wm)(j,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[G])),_:1}),(0,o.Wm)(D,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.canCombineGems,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t},[(0,o._)("div",{class:"gem-box row items-center justify-evenly",onClick:l=>e.setToCombine(t,0)},[(0,o.Wm)(S,{nft:0,level:t.level,color:t.color,quality:100,scale:.64,size:45},null,8,["level","color","scale"])],8,q),(0,o._)("div",x,"x "+(0,n.zw)(t.text),1)])))),128))])),_:1}),(0,o.Wm)(D,{class:"row items-center q-pb-none"})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var I=l(60499),S=l(19302),W=l(65457),N=l(44320),T=l(82108),U=l(85990),Z=l(88576),H=l.n(Z),D=l(17779),P=function(e,t,l,o){function n(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,a){function r(e){try{i(o.next(e))}catch(t){a(t)}}function s(e){try{i(o["throw"](e))}catch(t){a(t)}}function i(e){e.done?l(e.value):n(e.value).then(r,s)}i((o=o.apply(e,t||[])).next())}))},j=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,l=e[Symbol.asyncIterator];return l?l.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(l){t[l]=e[l]&&function(t){return new Promise((function(o,a){t=e[l](t),n(o,a,t.done,t.value)}))}}function n(e,t,l,o){Promise.resolve(o).then((function(t){e({value:t,done:l})}),t)}};const Q=l(10875);function A(e){D.log("Switch network: ",(0,U.v)().networks[e].name,(0,U.v)().networks[e].id),(0,U.v)().initWeb3(e)}const z={title:"Crystal - Crafting"},R=(0,o.aZ)({name:"CraftingPage",components:{NftMenu:N.Z,CrystalGem:T.Z},setup(){const e=(0,S.Z)();e.dark.set(!0),(0,W.Z)(z);const t=(0,I.iH)([]),l=(0,I.iH)([]),o=(0,I.iH)([]),n=(0,I.iH)([]),a=(0,I.iH)(),r=(0,I.iH)(),s=(0,I.iH)(),i=(0,I.iH)();let c=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],u=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];const f=e=>new Promise((t=>setTimeout(t,e))),m=(0,I.iH)(!1),d=(0,I.iH)(!1),v=(0,I.iH)(0),p=(0,I.iH)("0x30a8C517b35e7D635f77AaeeBb0C704015dFaa6A");function w(){return P(this,void 0,void 0,(function*(){const e=yield(0,U.v)().web3.eth.net.getId().then((e=>(D.log(e),e))).catch((e=>(D.log("checkNetwork: ",e),-1)));return e}))}function y(e){return P(this,void 0,void 0,(function*(){const t=(0,U.v)().networks[e].id,l=(0,U.v)().networks[e].name,o=(0,U.v)().networks[e].tokenName,n=(0,U.v)().networks[e].symbol,a=(0,U.v)().networks[e].rpcUrl,r=(0,U.v)().networks[e].explorer,s="0x"+t.toString(16);if("undefined"!==typeof window.ethereum)try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:s}]}),location.reload()}catch(i){if(D.log(i),4902===i.code){D.log("Add Chain");try{yield window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:s,chainName:l,nativeCurrency:{name:o,symbol:n,decimals:18},rpcUrls:[a],blockExplorerUrls:[r]}]}),location.reload()}catch(c){alert(c.message)}}else alert(i.message)}}))}function g(e){return P(this,void 0,void 0,(function*(){D.log("reSyncURI:",e);const t=yield H().Web3API.token.reSyncMetadata({chain:"polygon",address:p.value,token_id:e,flag:"uri"});D.log("reSyncURI resp:",e,t)}))}function h(e){var t,l,o,n;return P(this,void 0,void 0,(function*(){try{for(t=j(e);l=yield t.next(),!l.done;){const e=l.value;yield f(1e3),yield g(e),yield b(e)}}catch(a){o={error:a}}finally{try{l&&!l.done&&(n=t.return)&&(yield n.call(t))}finally{if(o)throw o.error}}}))}function b(e){return P(this,void 0,void 0,(function*(){D.log("getGemURI id:",e);const o=(0,U.v)().web3Instance,n=new o.eth.Contract(Q,p.value);n.methods.tokenURI(e).call().then((function(o){D.log("getGemURI: ",o);const n=parseInt(e),a=JSON.parse(o),r=(0,U.v)().web3.utils.toHex(a.properties);let s=10,i=10;for(let e=2;e<14;e++){const t=parseInt(r[e],16);e<8?s+=t:e<14&&(i+=t)}const c={nft:n,level:a.level,color:a.color,quality:s,scale:i/100,properties:r,text:""};for(let e=0;e<l.value.length;e++){const t=l.value[e];t.nft==n&&l.value.splice(e,1)}_(c,n),localStorage.setItem("userGems",JSON.stringify(t.value))})).catch((function(e){D.log("getGemURI: ",e)}))}))}function k(){return P(this,void 0,void 0,(function*(){const e="https://uf9sagja413n.usemoralis.com:2053/server",o="Kq3K4FzmThqNQqDX2APLDoBueUYy8IA1u4eBJTBp";yield H().start({serverUrl:e,appId:o});const n=(0,U.v)().account,a=(0,U.v)().web3Instance;if(!a.utils.isAddress(n))return alert("Need Connect Wallet!"),void D.log("Not Address:",n);try{const e=yield H().Web3API.account.getNFTsForContract({chain:"polygon",address:n,token_address:p.value});D.log(e.result);const o=e.result||[];G(o);let a=[];l.value=[],o.forEach((e=>{const o=parseInt(e.token_id);if(e.token_uri){const t=JSON.parse(e.token_uri),l=(0,U.v)().web3.utils.toHex(t.properties);let n=10,a=10;for(let e=2;e<14;e++){const t=parseInt(l[e],16);e<8?n+=t:e<14&&(a+=t)}const r={nft:o,level:t.level,color:t.color,quality:n,scale:a/100,properties:l,text:""};_(r,o)}else{const n={nft:o,level:8,color:0,quality:10,scale:1,properties:"0xffffffffffff",text:""};a.push(e.token_id);let r=!1;for(let e=0;e<t.value.length;e++){const l=t.value[e];if(l.nft==o){r=!0;break}}r||(l.value.unshift(n),D.log(n))}})),h(a),localStorage.setItem("userGems",JSON.stringify(t.value))}catch(r){D.log(r)}}))}function _(e,l){let o=!1;for(let n=0;n<t.value.length;n++){const e=t.value[n];if(e.nft==l){o=!0;break}}o||(t.value.unshift(e),D.log(e))}function G(e){for(let l=0;l<t.value.length;l++){const o=t.value[l];let n=!1;for(let t=0;t<e.length;t++){const l=e[t].token_id;if(l==o.nft){n=!0;break}}n||t.value.splice(l,1)}}function q(){a.value=void 0,r.value=void 0,s.value=void 0,i.value=void 0,o.value=[];for(let e=0;e<6;e++)for(let t=0;t<16;t++)c[e][t]=0;for(let e=0;e<t.value.length;e++){const l=t.value[e],o=l.color,n=l.level;c[o][n]+=1}D.log("gemTree:",c);for(let e=0;e<6;e++)for(let t=0;t<15;t++)if(c[e][t]>=3){const l=Math.floor(c[e][t]/3);u[e][t+1]=l;const n={nft:0,level:t+1,color:e,quality:100,scale:1,properties:"0xffffffffffff",text:l.toString()};o.value.push(n)}D.log("combineTree:",u),D.log("Can combine:",o.value),d.value=!0}function x(e,l){switch(l){case 0:i.value=e,n.value=[];for(let l=0;l<t.value.length;l++){const o=t.value[l];o.color==e.color&&o.level+1==e.level&&n.value.push(o)}a.value=n.value[0],r.value=n.value[1],s.value=n.value[2];break;case 1:a.value=e;break;case 2:r.value=e;break;case 3:s.value=e;break;default:break}d.value=!1}let C={};for(let I=0;I<101;I++)C[I.toString()]=0;return{gemNftContract:p,netIndex:v,switchNet:m,chooseTar:d,userGems:t,newGems:l,canCombineGems:o,fromGems:n,fromGem1:a,fromGem2:r,fromGem3:s,toCombineGem:i,gemTree:c,combineTree:u,checkNetwork:w,switchNetwork:y,getUserGems:k,updateTree:q,setToCombine:x,initGame(){return P(this,void 0,void 0,(function*(){let e=new URLSearchParams(window.location.search),t=e.get("ref");D.log(t||"No Ref");const l=v.value;A(l);const o=yield w();if(o!=(0,U.v)().networks[l].id)return D.log(o,"!=",(0,U.v)().networks[l].id),void(m.value=!0)}))},test(){for(let e=0;e<1e3;e++){let e=0,t=(0,U.v)().web3.utils.randomHex(3);for(let l=2;l<8;l++){const o=parseInt(t[l],16);e+=o}C[(e+10).toString()]+=1}D.log("Total:",C)},initDate(){localStorage.getItem("userGems")&&(Object.assign(t.value,JSON.parse(localStorage.getItem("userGems")||"")),t.value.sort((function(e,t){return e.nft<t.nft?1:e.nft>t.nft?-1:0})))}}},beforeMount(){this.initDate(),this.initGame(),this.getUserGems()}});var J=l(11639),O=l(69885),V=l(89800),B=l(84106),E=l(68879),F=l(32074),M=l(44458),K=l(63190),Y=l(61357),L=l(90136),X=l(11821),$=l(62146),ee=l(69984),te=l.n(ee);const le=(0,J.Z)(R,[["render",C],["__scopeId","data-v-8c7ebc48"]]),oe=le;te()(R,"components",{QPage:O.Z,QTabPanels:V.Z,QTabPanel:B.Z,QBtn:E.Z,QDialog:F.Z,QCard:M.Z,QCardSection:K.Z,QAvatar:Y.Z,QSpace:L.Z,QCardActions:X.Z}),te()(R,"directives",{ClosePopup:$.Z})}}]);
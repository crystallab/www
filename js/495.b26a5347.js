"use strict";(self["webpackChunkcrystal_dapp"]=self["webpackChunkcrystal_dapp"]||[]).push([[495],{15924:(e,t,l)=>{l.r(t),l.d(t,{default:()=>ke});var o=l(59835),n=l(86970);const s=e=>((0,o.dD)("data-v-1cb23f24"),e=e(),(0,o.Cn)(),e),a={class:"q-pa-md",style:{"max-width":"1439px"}},r=s((()=>(0,o._)("div",{class:"text-h6 text-center"},"Combine Gem",-1))),i=["onClick"],c={class:"gem-count text-right text-bold"},m=s((()=>(0,o._)("br",null,null,-1))),u={class:"gem-box row items-center justify-evenly"},f={key:1,class:"nft-id"},d=s((()=>(0,o._)("i",{class:"las la-angle-down inline",sixe:"xs"},null,-1))),v=[d],w=s((()=>(0,o._)("div",{class:"text-h6"},[(0,o._)("i",{class:"las la-plus"})],-1))),g={class:"gem-box row items-center justify-evenly"},h={key:1,class:"nft-id"},y=s((()=>(0,o._)("i",{class:"las la-angle-down",sixe:"xs"},null,-1))),p=[y],b=s((()=>(0,o._)("div",{class:"text-center"},[(0,o._)("i",{class:"las la-angle-double-down"})],-1))),k={class:"gem-box row items-center justify-evenly"},_={key:0,class:"info",style:{"text-shadow":"#000 1px 0 10px",position:"absolute",transform:"translate(0%, -50%)",top:"50%",right:"50%","padding-right":"35px"}},x={key:1,class:"info",style:{"text-shadow":"#000 1px 0 10px",position:"absolute",transform:"translate(0%, -50%)",top:"50%",left:"50%","padding-left":"35px"}},G={class:""},C={class:"gem-level q-pr-sm"},q={class:"q-pr-sm text-h6"},W={class:"gem-quality text-caption text-grey text-center"},I=s((()=>(0,o._)("div",{class:"text-center"},null,-1))),S=(0,o.Uk)(" Coming Soon "),R=s((()=>(0,o._)("span",{class:"text-h6 q-ml-sm"},"Incorrect blockchain",-1))),N=s((()=>(0,o._)("span",{class:"q-ml-sm"},"You are currently not connected to the correct network.",-1))),U={class:"info row",style:{"text-shadow":"#000 1px 0 10px"}},H={class:"text-h6"},z={key:0,class:"gem-box row items-center justify-evenly"},D={class:"nft-id-2"},T=["onClick"],Z=s((()=>(0,o._)("i",{class:"las la-plus"},null,-1))),j=[Z],P=s((()=>(0,o._)("br",null,null,-1))),A=(0,o.Uk)(" Choose a Target "),Q=["onClick"],F={class:"gem-count text-right text-bold"};function V(e,t,l,s,d,y){const Z=(0,o.up)("CrystalGem"),V=(0,o.up)("q-card-section"),$=(0,o.up)("q-btn"),E=(0,o.up)("q-tab-panel"),J=(0,o.up)("q-tab-panels"),O=(0,o.up)("nft-menu"),K=(0,o.up)("q-avatar"),M=(0,o.up)("q-space"),Y=(0,o.up)("q-card-actions"),B=(0,o.up)("q-card"),L=(0,o.up)("q-dialog"),X=(0,o.up)("q-page"),ee=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(X,{class:"row items-center justify-evenly bg-pic",style:{"padding-top":"58px"}},{default:(0,o.w5)((()=>[(0,o._)("div",a,[(0,o.Wm)(J,{class:"",flat:"","model-value":"crafting",animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{class:"items-center",name:"crafting"},{default:(0,o.w5)((()=>[r,(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.canCombineGems,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t},[(0,o._)("div",{class:"gem-box row items-center justify-evenly",onClick:l=>e.setToCombine(t,0)},[(0,o.Wm)(Z,{nft:0,level:t.level,color:t.color,quality:100,scale:.64,size:50},null,8,["level","color","scale"])],8,i),(0,o._)("div",c,"x "+(0,n.zw)(t.text),1)])))),128))])),_:1}),m,(0,o.Wm)(V,{class:"row items-center justify-evenly"},{default:(0,o.w5)((()=>[(0,o._)("div",u,[e.fromGem1?((0,o.wg)(),(0,o.iD)("div",{key:e.fromGem1},[(0,o.Wm)(Z,{nft:e.fromGem1.nft,level:e.fromGem1.level,color:e.fromGem1.color,quality:e.fromGem1.quality,scale:e.fromGem1.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,o.kq)("",!0),e.fromGem1?((0,o.wg)(),(0,o.iD)("div",f," #"+(0,n.zw)(e.fromGem1.nft),1)):(0,o.kq)("",!0),e.fromGem1&&e.fromGems.length>2?((0,o.wg)(),(0,o.iD)("div",{key:2,class:"choose-from-gem text-center no-padding",onClick:t[0]||(t[0]=t=>{e.chooseFrom=!0,e.chooseNum=1})},v)):(0,o.kq)("",!0)]),w,(0,o._)("div",g,[e.fromGem2?((0,o.wg)(),(0,o.iD)("div",{key:e.fromGem2},[(0,o.Wm)(Z,{nft:e.fromGem2.nft,level:e.fromGem2.level,color:e.fromGem2.color,quality:e.fromGem2.quality,scale:e.fromGem2.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,o.kq)("",!0),e.fromGem2?((0,o.wg)(),(0,o.iD)("div",h," #"+(0,n.zw)(e.fromGem2.nft),1)):(0,o.kq)("",!0),e.fromGem2&&e.fromGems.length>2?((0,o.wg)(),(0,o.iD)("div",{key:2,class:"choose-from-gem text-center",onClick:t[1]||(t[1]=t=>{e.chooseFrom=!0,e.chooseNum=2})},p)):(0,o.kq)("",!0)])])),_:1}),b,(0,o.Wm)(V,{class:"row items-center justify-evenly"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o._)("div",k,[e.toCombineGem?((0,o.wg)(),(0,o.j4)(Z,{key:e.toCombineGem,nft:0,level:e.toCombineGem.level,color:e.toCombineGem.color,quality:100,scale:.8,size:50},null,8,["level","color","scale"])):(0,o.kq)("",!0)]),e.toCombineGem?((0,o.wg)(),(0,o.iD)("div",_,[(0,o._)("div",{class:(0,n.C_)(e.getRarity(e.toCombineGem.level).rarity+" text-h6 text-right")},(0,n.zw)(e.$t("gems.levels."+e.toCombineGem.level)+e.$t("gems.names."+e.toCombineGem.color)),3),(0,o._)("div",{class:(0,n.C_)(e.getRarity(e.toCombineGem.level).rarity+" text-right")},(0,n.zw)(e.$t("gems."+e.getRarity(e.toCombineGem.level).rarity)+" "+e.$t("gems.gem")),3)])):(0,o.kq)("",!0),e.toCombineGem?((0,o.wg)(),(0,o.iD)("div",x,[(0,o._)("div",G,[(0,o._)("div",C,(0,n.zw)(e.$t("crafting.successRate")+":"),1),(0,o._)("div",q,(0,n.zw)((((e.fromGem1?e.fromGem1.quality:0)+(e.fromGem2?e.fromGem2.quality:0))/2).toFixed(2))+"% ",1)])])):(0,o.kq)("",!0)])])),_:1}),(0,o._)("div",W,(0,n.zw)(e.$t("crafting.successInfo")),1),I,(0,o.Wm)(V,null,{default:(0,o.w5)((()=>[(0,o.Wm)($,{unelevated:"",color:"primary",class:"min-width-320 full-width","no-caps":"",onClick:t[2]||(t[2]=t=>e.combineClicked())},{default:(0,o.w5)((()=>[S])),_:1})])),_:1})])),_:1})])),_:1})]),(0,o.Wm)(O),(0,o.Wm)(L,{modelValue:e.switchNet,"onUpdate:modelValue":t[4]||(t[4]=t=>e.switchNet=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(B,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(K,{icon:"signal_wifi_off",color:"primary","text-color":"white",size:"xs"}),R,(0,o.Wm)(M),(0,o.wy)((0,o.Wm)($,{icon:"close",flat:"",round:"",dense:""},null,512),[[ee]])])),_:1}),(0,o.Wm)(V,{class:"row items-center"},{default:(0,o.w5)((()=>[N])),_:1}),(0,o.Wm)(Y,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)($,{class:"full-width",label:"Switch",color:"primary",onClick:t[3]||(t[3]=t=>e.switchNetwork(e.netIndex))},null,512),[[ee]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(L,{modelValue:e.chooseFrom,"onUpdate:modelValue":t[5]||(t[5]=t=>e.chooseFrom=t)},{default:(0,o.w5)((()=>[(0,o.Wm)(B,{class:"bg-glass min-width-320"},{default:(0,o.w5)((()=>[(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[(0,o._)("div",U,[(0,o._)("div",H,(0,n.zw)(e.$t("crafting.chooseA"))+"Â ",1),(0,o._)("div",{class:(0,n.C_)(e.getRarity(e.fromGems[0].level).rarity+" text-h6")}," ["+(0,n.zw)(e.$t("gems.levels."+e.fromGems[0].level)+e.$t("gems.names."+e.fromGems[0].color))+"] ",3)])])),_:1}),(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.fromGems,(t=>((0,o.wg)(),(0,o.iD)("div",{class:"row",key:t},[t.nft!=e.fromGem1.nft&&t.nft!=e.fromGem2.nft?((0,o.wg)(),(0,o.iD)("div",z,[(0,o._)("div",null,[(0,o.Wm)(Z,{nft:t.nft,level:t.level,color:t.color,quality:t.quality,scale:t.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])]),(0,o._)("div",D," #"+(0,n.zw)(t.nft),1),(0,o._)("div",{class:"choose-from-gem text-center",onClick:l=>e.setToCombine(t,e.chooseNum)},j,8,T)])):(0,o.kq)("",!0)])))),128))])),_:1}),(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[P])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(L,{modelValue:e.chooseTar,"onUpdate:modelValue":t[6]||(t[6]=t=>e.chooseTar=t)},{default:(0,o.w5)((()=>[(0,o.Wm)(B,{class:"bg-glass min-width-320"},{default:(0,o.w5)((()=>[(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[A])),_:1}),(0,o.Wm)(V,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.canCombineGems,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t},[(0,o._)("div",{class:"gem-box row items-center justify-evenly",onClick:l=>e.setToCombine(t,0)},[(0,o.Wm)(Z,{nft:0,level:t.level,color:t.color,quality:100,scale:.64,size:45},null,8,["level","color","scale"])],8,Q),(0,o._)("div",F,"x "+(0,n.zw)(t.text),1)])))),128))])),_:1}),(0,o.Wm)(V,{class:"row items-center q-pb-none"})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var $=l(60499),E=l(19302),J=l(65457),O=l(44320),K=l(82108),M=l(85990),Y=l(88576),B=l.n(Y),L=l(17779),X=function(e,t,l,o){function n(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,s){function a(e){try{i(o.next(e))}catch(t){s(t)}}function r(e){try{i(o["throw"](e))}catch(t){s(t)}}function i(e){e.done?l(e.value):n(e.value).then(a,r)}i((o=o.apply(e,t||[])).next())}))},ee=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,l=e[Symbol.asyncIterator];return l?l.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(l){t[l]=e[l]&&function(t){return new Promise((function(o,s){t=e[l](t),n(o,s,t.done,t.value)}))}}function n(e,t,l,o){Promise.resolve(o).then((function(t){e({value:t,done:l})}),t)}};const te=l(10875);function le(e){L.log("Switch network: ",(0,M.v)().networks[e].name,(0,M.v)().networks[e].id),(0,M.v)().initWeb3(e)}const oe={title:"Crystal - Crafting"},ne=(0,o.aZ)({name:"CraftingPage",components:{NftMenu:O.Z,CrystalGem:K.Z},setup(){const e=(0,E.Z)();e.dark.set(!0),(0,J.Z)(oe);const t=(0,$.iH)([]),l=(0,$.iH)([]),o=(0,$.iH)([]),n=(0,$.iH)([]),s=(0,$.iH)(),a=(0,$.iH)(),r=(0,$.iH)();let i=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],c=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];const m=e=>new Promise((t=>setTimeout(t,e))),u=(0,$.iH)(!1),f=(0,$.iH)(!1),d=(0,$.iH)(!1),v=(0,$.iH)(0),w=(0,$.iH)(0),g=(0,$.iH)("0x30a8C517b35e7D635f77AaeeBb0C704015dFaa6A");function h(){return X(this,void 0,void 0,(function*(){const e=yield(0,M.v)().web3.eth.net.getId().then((e=>(L.log(e),e))).catch((e=>(L.log("checkNetwork: ",e),-1)));return e}))}function y(e){return X(this,void 0,void 0,(function*(){const t=(0,M.v)().networks[e].id,l=(0,M.v)().networks[e].name,o=(0,M.v)().networks[e].tokenName,n=(0,M.v)().networks[e].symbol,s=(0,M.v)().networks[e].rpcUrl,a=(0,M.v)().networks[e].explorer,r="0x"+t.toString(16);if("undefined"!==typeof window.ethereum)try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:r}]}),location.reload()}catch(i){if(L.log(i),4902===i.code){L.log("Add Chain");try{yield window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:r,chainName:l,nativeCurrency:{name:o,symbol:n,decimals:18},rpcUrls:[s],blockExplorerUrls:[a]}]}),location.reload()}catch(c){alert(c.message)}}else alert(i.message)}}))}function p(e){return X(this,void 0,void 0,(function*(){L.log("reSyncURI:",e);const t=yield B().Web3API.token.reSyncMetadata({chain:"polygon",address:g.value,token_id:e,flag:"uri"});L.log("reSyncURI resp:",e,t)}))}function b(e){var t,l,o,n;return X(this,void 0,void 0,(function*(){try{for(t=ee(e);l=yield t.next(),!l.done;){const e=l.value;yield m(1e3),yield p(e),yield k(e)}}catch(s){o={error:s}}finally{try{l&&!l.done&&(n=t.return)&&(yield n.call(t))}finally{if(o)throw o.error}}}))}function k(e){return X(this,void 0,void 0,(function*(){L.log("getGemURI id:",e);const o=(0,M.v)().web3Instance,n=new o.eth.Contract(te,g.value);n.methods.tokenURI(e).call().then((function(o){L.log("getGemURI: ",o);const n=parseInt(e),s=JSON.parse(o),a=(0,M.v)().web3.utils.toHex(s.properties);let r=10,i=10;for(let e=2;e<14;e++){const t=parseInt(a[e],16);e<8?r+=t:e<14&&(i+=t)}const c={nft:n,level:s.level,color:s.color,quality:r,scale:i/100,properties:a,text:""};for(let e=0;e<l.value.length;e++){const t=l.value[e];t.nft==n&&l.value.splice(e,1)}x(c,n),localStorage.setItem("userGems",JSON.stringify(t.value))})).catch((function(e){L.log("getGemURI: ",e)}))}))}function _(){return X(this,void 0,void 0,(function*(){const e="https://g19udojubwks.usemoralis.com:2053/server",o="P749qSdfiW93rIsFAtUSWNAnJK4HX8hyvauadRFz";yield B().start({serverUrl:e,appId:o});const n=(0,M.v)().account,s=(0,M.v)().web3Instance;if(!s.utils.isAddress(n))return alert("Need Connect Wallet!"),void L.log("Not Address:",n);try{const e=yield B().Web3API.account.getNFTsForContract({chain:"polygon",address:n,token_address:g.value});L.log(e.result);const o=e.result||[];G(o);let s=[];l.value=[],o.forEach((e=>{const o=parseInt(e.token_id);if(e.token_uri){const t=JSON.parse(e.token_uri),l=(0,M.v)().web3.utils.toHex(t.properties);let n=10,s=10;for(let e=2;e<14;e++){const t=parseInt(l[e],16);e<8?n+=t:e<14&&(s+=t)}const a={nft:o,level:t.level,color:t.color,quality:n,scale:s/100,properties:l,text:""};x(a,o)}else{const n={nft:o,level:8,color:0,quality:10,scale:1,properties:"0xffffffffffff",text:""};s.push(e.token_id);let a=!1;for(let e=0;e<t.value.length;e++){const l=t.value[e];if(l.nft==o){a=!0;break}}a||(l.value.unshift(n),L.log(n))}})),b(s),localStorage.setItem("userGems",JSON.stringify(t.value))}catch(a){L.log(a)}}))}function x(e,l){let o=!1;for(let n=0;n<t.value.length;n++){const e=t.value[n];if(e.nft==l){o=!0;break}}o||(t.value.unshift(e),L.log(e))}function G(e){for(let l=0;l<t.value.length;l++){const o=t.value[l];let n=!1;for(let t=0;t<e.length;t++){const l=e[t].token_id;if(l==o.nft){n=!0;break}}n||t.value.splice(l,1)}}function C(e){s.value=void 0,a.value=void 0,r.value=void 0;for(let t=0;t<6;t++)for(let e=0;e<16;e++)i[t][e]=0;for(let o=0;o<t.value.length;o++){const e=t.value[o],l=e.color,n=e.level;i[l][n]+=1}L.log("gemTree:",i);let l=[];for(let t=0;t<6;t++)for(let e=0;e<15;e++)if(i[t][e]>=2){const o=Math.floor(i[t][e]/2);c[t][e+1]=o;const n={nft:0,level:e+1,color:t,quality:100,scale:1,properties:"0xffffffffffff",text:o.toString()};l.push(n)}o.value=l,L.log("Can combine:",o.value)}function q(e,l){switch(L.log("position:",l),l){case 0:r.value=e,n.value=[];for(let l=0;l<t.value.length;l++){const o=t.value[l];o.color==e.color&&o.level+1==e.level&&n.value.push(o)}n.value.sort((function(e,t){return e.quality<t.quality?1:e.quality>t.quality?-1:0})),s.value=n.value[0],a.value=n.value[1];break;case 1:s.value=e;break;case 2:a.value=e;break;default:L.log("default");break}f.value=!1,d.value=!1}let W={};for(let I=0;I<101;I++)W[I.toString()]=0;return{gemNftContract:g,netIndex:w,switchNet:u,chooseTar:f,chooseFrom:d,chooseNum:v,userGems:t,newGems:l,canCombineGems:o,fromGems:n,fromGem1:s,fromGem2:a,toCombineGem:r,gemTree:i,combineTree:c,checkNetwork:h,switchNetwork:y,getUserGems:_,updateTree:C,setToCombine:q,initGame(){return X(this,void 0,void 0,(function*(){let e=new URLSearchParams(window.location.search),t=e.get("ref");L.log(t||"No Ref");const l=w.value;le(l);const o=yield h();if(o!=(0,M.v)().networks[l].id)return L.log(o,"!=",(0,M.v)().networks[l].id),void(u.value=!0)}))},combineClicked(){return X(this,void 0,void 0,(function*(){void 0!=s.value&&void 0!=a.value&&s.value.level==a.value.level&&s.value.color==a.value.color&&L.log("Combine Gems: ",s.value.nft,a.value.nft)}))},test(){for(let e=0;e<1e3;e++){let e=0,t=(0,M.v)().web3.utils.randomHex(3);for(let l=2;l<8;l++){const o=parseInt(t[l],16);e+=o}W[(e+10).toString()]+=1}L.log("Total:",W)},getRarity(e){let t="Common",l="C";switch(e){case 4:case 5:case 6:case 7:l="UC";break;case 8:case 9:l="R";break;case 10:l="RR";break;case 11:l="RRR";break;case 12:l="SR";break;case 13:l="HR";break;case 14:l="UR";break;case 15:l="SSR";break;default:break}switch(e){case 4:case 5:case 6:case 7:t="Uncommon";break;case 8:case 9:case 10:case 11:t="Rare";break;case 12:case 13:case 14:case 15:t="Epic";break;default:break}return{rarity:t,short:l}},initDate(){localStorage.getItem("userGems")&&(Object.assign(t.value,JSON.parse(localStorage.getItem("userGems")||"")),t.value.sort((function(e,t){return e.nft<t.nft?1:e.nft>t.nft?-1:0})))}}},beforeMount(){this.initDate(),this.initGame(),this.getUserGems(),this.updateTree(!1)}});var se=l(11639),ae=l(69885),re=l(89800),ie=l(84106),ce=l(63190),me=l(57691),ue=l(68879),fe=l(32074),de=l(44458),ve=l(61357),we=l(90136),ge=l(11821),he=l(62146),ye=l(69984),pe=l.n(ye);const be=(0,se.Z)(ne,[["render",V],["__scopeId","data-v-1cb23f24"]]),ke=be;pe()(ne,"components",{QPage:ae.Z,QTabPanels:re.Z,QTabPanel:ie.Z,QCardSection:ce.Z,QChip:me.Z,QBtn:ue.Z,QDialog:fe.Z,QCard:de.Z,QAvatar:ve.Z,QSpace:we.Z,QCardActions:ge.Z}),pe()(ne,"directives",{ClosePopup:he.Z})}}]);
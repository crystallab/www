"use strict";(self["webpackChunkcrystal_dapp"]=self["webpackChunkcrystal_dapp"]||[]).push([[990],{98118:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Le});var a=n(59835),l=n(86970);const s=e=>((0,a.dD)("data-v-6bae030f"),e=e(),(0,a.Cn)(),e),o={class:"q-pa-md",style:{"max-width":"1439px"}},i={class:"text-h6 text-center"},r={class:"row q-pa-none"},c=["onClick"],u={class:"gem-count text-right text-bold"},m=s((()=>(0,a._)("br",null,null,-1))),d=s((()=>(0,a._)("i",{class:"mdi-blank"},null,-1))),f=s((()=>(0,a._)("i",{class:"mdi-blank"},null,-1))),p={class:"gem-box row items-center justify-evenly"},v={key:1,class:"nft-id"},y=s((()=>(0,a._)("i",{class:"las la-angle-down inline",sixe:"xs"},null,-1))),g=[y],w=s((()=>(0,a._)("div",{class:"text-h6"},[(0,a._)("i",{class:"las la-plus"})],-1))),h={class:"gem-box row items-center justify-evenly"},b={key:1,class:"nft-id"},x=s((()=>(0,a._)("i",{class:"las la-angle-down",sixe:"xs"},null,-1))),_=[x],k=s((()=>(0,a._)("i",{class:"mdi-blank"},null,-1))),G=s((()=>(0,a._)("i",{class:"mdi-blank"},null,-1))),q=s((()=>(0,a._)("div",{class:"text-center"},[(0,a._)("i",{class:"las la-angle-double-down"})],-1))),C={class:"gem-box row items-center justify-evenly"},T={key:0,class:"info",style:{"text-shadow":"#000 1px 0 10px",position:"absolute",transform:"translate(0%, -50%)",top:"50%",right:"50%","padding-right":"35px"}},W={key:1,class:"info",style:{"text-shadow":"#000 1px 0 10px",position:"absolute",transform:"translate(0%, -50%)",top:"50%",left:"50%","padding-left":"35px"}},S={class:""},I={class:"gem-level q-pr-sm"},H={class:"q-pr-sm text-h6"},z={class:"gem-quality text-caption text-grey text-center"},N=s((()=>(0,a._)("div",{class:"text-center"},null,-1))),R=s((()=>(0,a._)("span",{class:"text-h6 q-ml-sm"},"Incorrect blockchain",-1))),U=s((()=>(0,a._)("span",{class:"q-ml-sm"},"You are currently not connected to the correct network.",-1))),A={class:"info row",style:{"text-shadow":"#000 1px 0 10px"}},D={class:"text-h6"},Z={key:0,class:"gem-box row items-center justify-evenly"},M={class:"nft-id-2"},P=["onClick"],Q=s((()=>(0,a._)("i",{class:"las la-plus"},null,-1))),$=[Q],j=s((()=>(0,a._)("br",null,null,-1))),O=(0,a.Uk)(" Choose a Target "),V=["onClick"],E={class:"gem-count text-right text-bold"},F=s((()=>(0,a._)("span",{class:"text-h6 q-ml-sm"},"Combine Gem",-1))),J={class:"q-pa-xs"},B={key:0,class:"text-left"},K=s((()=>(0,a._)("a",null,[(0,a._)("span",{class:"cursor-pointer"}," Sign transaction with your wallet and we will never touch your private key! ")],-1))),Y=[K],L={key:1,class:"text-left text-red"},X=["href"],ee={class:"cursor-pointer"},te=s((()=>(0,a._)("a",null,[(0,a._)("span",{class:"cursor-pointer"}," Transaction is broadcasted, waiting for confirmation. ")],-1))),ne={class:"row"},ae=s((()=>(0,a._)("div",{class:"gem-frame row items-center justify-evenly"},[(0,a._)("div",{class:"text-h3"},"?")],-1))),le={class:"info",style:{"text-shadow":"#000 1px 0 10px"}},se={class:"text-h6 gem-name"},oe={class:"text-subtitle1"},ie={class:"gem-level"},re={class:"gem-scale"},ce={class:"gem-quality"},ue=s((()=>(0,a._)("br",null,null,-1))),me={class:"cursor-pointer"},de=s((()=>(0,a._)("br",null,null,-1))),fe=s((()=>(0,a._)("span",{class:"text-subtitle2 text-secondary q-ml-sm"},"https://crystal.network",-1)));function pe(e,t,n,s,y,x){const Q=(0,a.up)("CrystalGem"),K=(0,a.up)("q-card-section"),pe=(0,a.up)("q-btn"),ve=(0,a.up)("q-tab-panel"),ye=(0,a.up)("q-tab-panels"),ge=(0,a.up)("nft-menu"),we=(0,a.up)("q-avatar"),he=(0,a.up)("q-space"),be=(0,a.up)("q-card-actions"),xe=(0,a.up)("q-card"),_e=(0,a.up)("q-dialog"),ke=(0,a.up)("q-step"),Ge=(0,a.up)("q-linear-progress"),qe=(0,a.up)("q-stepper"),Ce=(0,a.up)("q-page"),Te=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(Ce,{class:"row items-center justify-evenly bg-pic",style:{"padding-top":"58px"}},{default:(0,a.w5)((()=>[(0,a._)("div",o,[(0,a.Wm)(ye,{class:"",flat:"","model-value":"crafting",animated:""},{default:(0,a.w5)((()=>[(0,a.Wm)(ve,{class:"items-center",name:"crafting"},{default:(0,a.w5)((()=>[(0,a._)("div",i,(0,l.zw)(e.$t("crafting.combineGem")),1),(0,a.Wm)(K,{class:"row items-center justify-evenly"},{default:(0,a.w5)((()=>[(0,a._)("div",r,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.canCombineGems,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t},[(0,a._)("div",{class:"gem-box row items-center justify-evenly",onClick:n=>e.setToCombine(t,0)},[(0,a.Wm)(Q,{nft:0,level:t.level,color:t.color,quality:100,scale:.64,size:50},null,8,["level","color","scale"])],8,c),(0,a._)("div",u," x "+(0,l.zw)(t.text),1)])))),128))])])),_:1}),m,(0,a.Wm)(K,{class:"row items-center justify-evenly"},{default:(0,a.w5)((()=>[d,f,(0,a._)("div",p,[e.fromGem1?((0,a.wg)(),(0,a.iD)("div",{key:e.fromGem1},[(0,a.Wm)(Q,{nft:e.fromGem1.nft,level:e.fromGem1.level,color:e.fromGem1.color,quality:e.fromGem1.quality,scale:e.fromGem1.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,a.kq)("",!0),e.fromGem1?((0,a.wg)(),(0,a.iD)("div",v,"#"+(0,l.zw)(e.fromGem1.nft),1)):(0,a.kq)("",!0),e.fromGem1&&e.fromGems.length>2?((0,a.wg)(),(0,a.iD)("div",{key:2,class:"choose-from-gem text-center no-padding",onClick:t[0]||(t[0]=t=>{e.chooseFrom=!0,e.chooseNum=1})},g)):(0,a.kq)("",!0)]),w,(0,a._)("div",h,[e.fromGem2?((0,a.wg)(),(0,a.iD)("div",{key:e.fromGem2},[(0,a.Wm)(Q,{nft:e.fromGem2.nft,level:e.fromGem2.level,color:e.fromGem2.color,quality:e.fromGem2.quality,scale:e.fromGem2.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])])):(0,a.kq)("",!0),e.fromGem2?((0,a.wg)(),(0,a.iD)("div",b,"#"+(0,l.zw)(e.fromGem2.nft),1)):(0,a.kq)("",!0),e.fromGem2&&e.fromGems.length>2?((0,a.wg)(),(0,a.iD)("div",{key:2,class:"choose-from-gem text-center",onClick:t[1]||(t[1]=t=>{e.chooseFrom=!0,e.chooseNum=2})},_)):(0,a.kq)("",!0)]),k,G])),_:1}),q,(0,a.Wm)(K,{class:"row items-center justify-evenly"},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a._)("div",C,[e.toCombineGem?((0,a.wg)(),(0,a.j4)(Q,{key:e.toCombineGem,nft:0,level:e.toCombineGem.level,color:e.toCombineGem.color,quality:100,scale:.8,size:50},null,8,["level","color","scale"])):(0,a.kq)("",!0)]),e.toCombineGem?((0,a.wg)(),(0,a.iD)("div",T,[(0,a._)("div",{class:(0,l.C_)(e.getRarity(e.toCombineGem.level).rarity+" text-h6 text-right")},(0,l.zw)(e.$t("gems.levels."+e.toCombineGem.level)+e.$t("gems.names."+e.toCombineGem.color)),3),(0,a._)("div",{class:(0,l.C_)(e.getRarity(e.toCombineGem.level).rarity+" text-right")},(0,l.zw)(e.$t("gems."+e.getRarity(e.toCombineGem.level).rarity)+" "+e.$t("gems.gem")),3)])):(0,a.kq)("",!0),e.toCombineGem?((0,a.wg)(),(0,a.iD)("div",W,[(0,a._)("div",S,[(0,a._)("div",I,(0,l.zw)(e.$t("crafting.successRate")+":"),1),(0,a._)("div",H,(0,l.zw)(Math.floor(((e.fromGem1?e.fromGem1.quality:0)+(e.fromGem2?e.fromGem2.quality:0))/2))+".00 % ",1)])])):(0,a.kq)("",!0)])])),_:1}),(0,a._)("div",z,(0,l.zw)(e.$t("crafting.successInfo")),1),N,(0,a.Wm)(K,null,{default:(0,a.w5)((()=>[(0,a.Wm)(pe,{unelevated:"",color:"primary",class:"min-width-320 full-width","no-caps":"",onClick:t[2]||(t[2]=t=>e.combineClicked())},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.$t("crafting.combine")),1)])),_:1})])),_:1})])),_:1})])),_:1})]),(0,a.Wm)(ge),(0,a.Wm)(_e,{modelValue:e.switchNet,"onUpdate:modelValue":t[4]||(t[4]=t=>e.switchNet=t),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(xe,{class:"bg-glass"},{default:(0,a.w5)((()=>[(0,a.Wm)(K,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(we,{icon:"signal_wifi_off",color:"primary","text-color":"white",size:"xs"}),R,(0,a.Wm)(he),(0,a.wy)((0,a.Wm)(pe,{icon:"close",flat:"",round:"",dense:""},null,512),[[Te]])])),_:1}),(0,a.Wm)(K,{class:"row items-center"},{default:(0,a.w5)((()=>[U])),_:1}),(0,a.Wm)(be,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(pe,{class:"full-width",label:"Switch",color:"primary",onClick:t[3]||(t[3]=t=>e.switchNetwork(e.netIndex))},null,512),[[Te]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(_e,{modelValue:e.chooseFrom,"onUpdate:modelValue":t[5]||(t[5]=t=>e.chooseFrom=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(xe,{class:"bg-glass min-width-320"},{default:(0,a.w5)((()=>[(0,a.Wm)(K,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[(0,a._)("div",A,[(0,a._)("div",D,(0,l.zw)(e.$t("crafting.chooseA"))+"Â ",1),(0,a._)("div",{class:(0,l.C_)(e.getRarity(e.fromGems[0].level).rarity+" text-h6")}," ["+(0,l.zw)(e.$t("gems.levels."+e.fromGems[0].level)+e.$t("gems.names."+e.fromGems[0].color))+"] ",3)])])),_:1}),(0,a.Wm)(K,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.fromGems,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"row",key:t},[t.nft!=e.fromGem1.nft&&t.nft!=e.fromGem2.nft?((0,a.wg)(),(0,a.iD)("div",Z,[(0,a._)("div",null,[(0,a.Wm)(Q,{nft:t.nft,level:t.level,color:t.color,quality:t.quality,scale:t.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])]),(0,a._)("div",M,"#"+(0,l.zw)(t.nft),1),(0,a._)("div",{class:"choose-from-gem text-center",onClick:n=>e.setToCombine(t,e.chooseNum)},$,8,P)])):(0,a.kq)("",!0)])))),128))])),_:1}),(0,a.Wm)(K,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[j])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(_e,{modelValue:e.chooseTar,"onUpdate:modelValue":t[6]||(t[6]=t=>e.chooseTar=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(xe,{class:"bg-glass min-width-320"},{default:(0,a.w5)((()=>[(0,a.Wm)(K,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[O])),_:1}),(0,a.Wm)(K,{class:"row items-center q-pb-none"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.canCombineGems,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t},[(0,a._)("div",{class:"gem-box row items-center justify-evenly",onClick:n=>e.setToCombine(t,0)},[(0,a.Wm)(Q,{nft:0,level:t.level,color:t.color,quality:100,scale:.64,size:45},null,8,["level","color","scale"])],8,V),(0,a._)("div",E,"x "+(0,l.zw)(t.text),1)])))),128))])),_:1}),(0,a.Wm)(K,{class:"row items-center q-pb-none"})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(_e,{modelValue:e.signTx,"onUpdate:modelValue":t[9]||(t[9]=t=>e.signTx=t),position:"top"},{default:(0,a.w5)((()=>[(0,a.Wm)(xe,{style:{top:"50px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(K,{class:"q-pa-xs row items-center q-pb-none"},{default:(0,a.w5)((()=>[F,(0,a.Wm)(he),(0,a.wy)((0,a.Wm)(pe,{icon:"close",flat:"",round:"",dense:""},null,512),[[Te]])])),_:1}),(0,a.Wm)(K,{class:"row items-center q-pa-xs"},{default:(0,a.w5)((()=>[(0,a._)("div",J,[(0,a.Wm)(qe,{modelValue:e.txStep,"onUpdate:modelValue":t[8]||(t[8]=t=>e.txStep=t),vertical:"",color:"primary",flat:"",animated:""},{default:(0,a.w5)((()=>[(0,a.Wm)(ke,{name:1,title:"Sign Transaction",icon:"las la-wallet",done:e.txStep>1,error:e.signTxErr.length>0},{default:(0,a.w5)((()=>[""==e.signTxErr?((0,a.wg)(),(0,a.iD)("div",B,Y)):((0,a.wg)(),(0,a.iD)("div",L,(0,l.zw)(e.signTxErr),1))])),_:1},8,["done","error"]),(0,a.Wm)(ke,{name:2,title:"Send Transaction",icon:"las la-receipt",done:e.txStep>2},{default:(0,a.w5)((()=>[(0,a._)("a",{href:e.linkAddress(e.signTxHash,e.netIndex,"tx"),target:"_blank",class:"text-grey-6"},[(0,a._)("span",ee,(0,l.zw)(" tx hash: "+e.shortAddress(e.signTxHash,6,!1)),1)],8,X),te,(0,a.Wm)(Ge,{dark:"",rounded:"",indeterminate:"",color:"secondary",class:"q-mt-sm"})])),_:1},8,["done"]),(0,a.Wm)(ke,{name:3,title:"Waiting for Result",icon:"las la-hourglass-half",done:e.txStep>3},{default:(0,a.w5)((()=>[(0,a._)("div",ne,[ae,(0,a._)("div",le,[(0,a._)("div",se,[(0,a.Uk)((0,l.zw)(e.$t("airdrop.gotGemNft")+":")+" ",1),(0,a._)("span",oe,"#"+(0,l.zw)(e.txGem),1)]),(0,a._)("div",ie,(0,l.zw)(e.$t("gems.level")+":")+" ??? ",1),(0,a._)("div",re,(0,l.zw)(e.$t("gems.weight")+":")+" ??? ",1),(0,a._)("div",ce,(0,l.zw)(e.$t("gems.quality")+":")+" ??? ",1)])]),ue,(0,a._)("a",null,[(0,a._)("span",me,(0,l.zw)(e.$t("airdrop.whenAppear")),1)]),de,(0,a.Wm)(pe,{onClick:t[7]||(t[7]=t=>e.signTx=!1),color:"primary",label:"OK",class:"q-ml-sm full-width",dense:""})])),_:1},8,["done"])])),_:1},8,["modelValue"])])])),_:1}),(0,a.Wm)(K,{class:"q-pa-xs row items-center q-pb-none"},{default:(0,a.w5)((()=>[fe])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var ve=n(60499),ye=n(19302),ge=n(65457),we=n(89949),he=n(82108),be=n(85990),xe=n(28488),_e=n(88576),ke=n.n(_e),Ge=n(17779),qe=function(e,t,n,a){function l(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function o(e){try{r(a.next(e))}catch(t){s(t)}}function i(e){try{r(a["throw"](e))}catch(t){s(t)}}function r(e){e.done?n(e.value):l(e.value).then(o,i)}r((a=a.apply(e,t||[])).next())}))},Ce=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(n){t[n]=e[n]&&function(t){return new Promise((function(a,s){t=e[n](t),l(a,s,t.done,t.value)}))}}function l(e,t,n,a){Promise.resolve(a).then((function(t){e({value:t,done:n})}),t)}};const Te=n(10875),We=n(72593);function Se(e){Ge.log("Switch network: ",(0,be.v)().networks[e].name,(0,be.v)().networks[e].id),(0,be.v)().initWeb3(e)}const Ie={title:"Crystal - Crafting"},He=(0,a.aZ)({name:"CraftingPage",components:{NftMenu:we.Z,CrystalGem:he.Z},setup(){const e=(0,ye.Z)();e.dark.set(!0),(0,ge.Z)(Ie);const t=(0,ve.iH)([]),n=(0,ve.iH)([]),a=(0,ve.iH)([]),l=(0,ve.iH)([]),s=(0,ve.iH)(),o=(0,ve.iH)(),i=(0,ve.iH)(),r=(0,ve.iH)(!1),c=(0,ve.iH)(""),u=(0,ve.iH)(""),m=(0,ve.iH)(1),d=(0,ve.iH)(0);let f=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],p=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];const v=e=>new Promise((t=>setTimeout(t,e))),y=(0,ve.iH)(!1),g=(0,ve.iH)(!1),w=(0,ve.iH)(!1),h=(0,ve.iH)(0),b="polygon",x=(0,ve.iH)(0),_=(0,ve.iH)("0x708654b970A717BbaF160157EBb0686671e4DA55"),k=(0,ve.iH)("0x30a8C517b35e7D635f77AaeeBb0C704015dFaa6A");function G(){return qe(this,void 0,void 0,(function*(){const e=yield(0,be.v)().web3.eth.net.getId().then((e=>(Ge.log(e),e))).catch((e=>(Ge.log("checkNetwork: ",e),-1)));return e}))}function q(e){return qe(this,void 0,void 0,(function*(){const t=(0,be.v)().networks[e].id,n=(0,be.v)().networks[e].name,a=(0,be.v)().networks[e].tokenName,l=(0,be.v)().networks[e].symbol,s=(0,be.v)().networks[e].rpcUrl,o=(0,be.v)().networks[e].explorer,i="0x"+t.toString(16);if("undefined"!==typeof window.ethereum)try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:i}]}),location.reload()}catch(r){if(Ge.log(r),4902===r.code){Ge.log("Add Chain");try{yield window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:i,chainName:n,nativeCurrency:{name:a,symbol:l,decimals:18},rpcUrls:[s],blockExplorerUrls:[o]}]}),location.reload()}catch(c){alert(c.message)}}else alert(r.message)}}))}function C(e){return qe(this,void 0,void 0,(function*(){Ge.log("reSyncURI:",e);const t=yield ke().Web3API.token.reSyncMetadata({chain:b,address:k.value,token_id:e,flag:"uri"});Ge.log("reSyncURI resp:",e,t)}))}function T(e){var t,n,a,l;return qe(this,void 0,void 0,(function*(){try{for(t=Ce(e);n=yield t.next(),!n.done;){const e=n.value;yield v(1e3),yield C(e),yield W(e)}}catch(s){a={error:s}}finally{try{n&&!n.done&&(l=t.return)&&(yield l.call(t))}finally{if(a)throw a.error}}}))}function W(e){return qe(this,void 0,void 0,(function*(){Ge.log("getGemURI id:",e);const a=(0,be.v)().web3Instance,l=new a.eth.Contract(Te,k.value);l.methods.tokenURI(e).call().then((function(a){if(!a.length)return void Ge.log("getGemURI length: ",a.length);Ge.log("getGemURI: ",a);const l=parseInt(e),s=JSON.parse(a),o=(0,be.v)().web3.utils.toHex(s.properties);let i=10,r=10;for(let e=2;e<14;e++){const t=parseInt(o[e],16);e<8?i+=t:e<14&&(r+=t)}const c={nft:l,level:s.level,color:s.color,quality:i,scale:r/100,properties:o,text:""};for(let e=0;e<n.value.length;e++){const t=n.value[e];t.nft==l&&n.value.splice(e,1)}z(c,l),localStorage.setItem("userGems",JSON.stringify(t.value))})).catch((function(e){Ge.log("getGemURI: ",e)}))}))}function S(){return qe(this,void 0,void 0,(function*(){const e="https://g19udojubwks.usemoralis.com:2053/server",a="P749qSdfiW93rIsFAtUSWNAnJK4HX8hyvauadRFz";yield ke().start({serverUrl:e,appId:a});const l=(0,be.v)().account,s=(0,be.v)().web3Instance;if(!s.utils.isAddress(l))return alert("Need Connect Wallet!"),void Ge.log("Not Address:",l);try{const e=yield ke().Web3API.account.getNFTsForContract({chain:b,address:l,token_address:k.value});Ge.log(e.result);const a=e.result||[];N(a);let s=[];n.value=[],a.forEach((e=>{const a=parseInt(e.token_id);if(e.token_uri){const t=JSON.parse(e.token_uri),n=(0,be.v)().web3.utils.toHex(t.properties);let l=10,s=10;for(let e=2;e<14;e++){const t=parseInt(n[e],16);e<8?l+=t:e<14&&(s+=t)}const o={nft:a,level:t.level,color:t.color,quality:l,scale:s/100,properties:n,text:""};z(o,a)}else{const l={nft:a,level:8,color:0,quality:10,scale:1,properties:"0xffffffffffff",text:""};s.push(e.token_id);let o=!1;for(let e=0;e<t.value.length;e++){const n=t.value[e];if(n.nft==a){o=!0;break}}o||(n.value.unshift(l),Ge.log(l))}})),T(s),localStorage.setItem("userGems",JSON.stringify(t.value)),R(!1)}catch(o){Ge.log(o)}}))}function I(e,t){var n="0";for(let a=0;a<e.length;a++){const l=e[a];if(l.address.toUpperCase()==t.toUpperCase()){const e=(0,be.v)().web3.eth.abi.decodeParameters(["uint256","uint256","uint256","uint256"],l.data);n=e[3].toString();break}}return parseInt(n)}function H(e,t){return qe(this,void 0,void 0,(function*(){if(!(0,be.v)().web3.utils.isAddress((0,be.v)().account))return void alert("Need Connect Wallet!");const n=x.value,a=yield G();if(a!=(0,be.v)().networks[n].id)return Ge.log(a,"!=",(0,be.v)().networks[n].id),void(y.value=!0);c.value="",u.value="",m.value=1,r.value=!0;const l=(0,be.v)().web3,s=_.value,o=(0,be.v)().account,i=new l.eth.Contract(We,s);let f=i.methods.combineGem(e,t),p=f.encodeABI();l.eth.estimateGas({from:o,to:s,value:0,data:p}).then((function(e){Ge.log("gasAmount: ",e),l.eth.sendTransaction({from:o,to:s,value:0,gas:parseInt((1.05*e).toString()),gasPrice:36e9,data:p}).on("transactionHash",(e=>{Ge.log("transactionHash: ",e),m.value=2,u.value=e})).on("receipt",(e=>{const t=I(e.logs,s);Ge.log("gemId:",t),d.value=t,m.value=3,S()})).on("error",(e=>{Ge.log("tx combineGem",e),c.value=e.message,m.value=1}))})).catch((function(e){Ge.log("estimateGas: ",e);let t=e.message.toString(),n=t.split(".")[1],a=JSON.parse(n),l=a.message.split(":");c.value=l[0]+": "+l[1]}))}))}function z(e,n){let a=!1;for(let l=0;l<t.value.length;l++){const e=t.value[l];if(e.nft==n){a=!0;break}}a||(t.value.unshift(e),Ge.log(e))}function N(e){for(let n=0;n<t.value.length;n++){const a=t.value[n];let l=!1;for(let t=0;t<e.length;t++){const n=e[t].token_id;if(n==a.nft){l=!0;break}}l||t.value.splice(n,1)}}function R(e){s.value=void 0,o.value=void 0,i.value=void 0;for(let t=0;t<6;t++)for(let e=0;e<16;e++)f[t][e]=0;for(let a=0;a<t.value.length;a++){const e=t.value[a],n=e.color,l=e.level;f[n][l]+=1}Ge.log("gemTree:",f);let n=[];for(let t=0;t<6;t++)for(let e=0;e<15;e++)if(f[t][e]>=2){const a=Math.floor(f[t][e]/2);p[t][e+1]=a;const l={nft:0,level:e+1,color:t,quality:100,scale:1,properties:"0xffffffffffff",text:a.toString()};n.push(l)}a.value=n,Ge.log("Can combine:",a.value)}function U(e,n){switch(Ge.log("position:",n),n){case 0:i.value=e,l.value=[];for(let n=0;n<t.value.length;n++){const a=t.value[n];a.color==e.color&&a.level+1==e.level&&l.value.push(a)}l.value.sort((function(e,t){return e.quality<t.quality?1:e.quality>t.quality?-1:0})),s.value=l.value[0],o.value=l.value[1];break;case 1:s.value=e;break;case 2:o.value=e;break;default:Ge.log("default");break}g.value=!1,w.value=!1}let A={};for(let D=0;D<101;D++)A[D.toString()]=0;return{shortAddress:xe.sC,copyAddress:xe.c4,linkAddress:xe.ol,signTx:r,signTxErr:c,signTxHash:u,txStep:m,txGem:d,gemNftContract:k,combineContract:_,netIndex:x,chain:b,switchNet:y,chooseTar:g,chooseFrom:w,chooseNum:h,userGems:t,newGems:n,canCombineGems:a,fromGems:l,fromGem1:s,fromGem2:o,toCombineGem:i,gemTree:f,combineTree:p,checkNetwork:G,switchNetwork:q,getUserGems:S,combineGemTx:H,updateTree:R,setToCombine:U,initGame(){return qe(this,void 0,void 0,(function*(){let e=new URLSearchParams(window.location.search),t=e.get("ref");Ge.log(t||"No Ref");const n=x.value;Se(n);const a=yield G();if(a!=(0,be.v)().networks[n].id)return Ge.log(a,"!=",(0,be.v)().networks[n].id),void(y.value=!0)}))},combineClicked(){return qe(this,void 0,void 0,(function*(){void 0!=s.value&&void 0!=o.value&&s.value.level==o.value.level&&s.value.color==o.value.color&&(Ge.log("Combine Gems: ",s.value.nft,o.value.nft),H(s.value.nft,o.value.nft),s.value=void 0,o.value=void 0,i.value=void 0)}))},test(){for(let e=0;e<1e3;e++){let e=0,t=(0,be.v)().web3.utils.randomHex(3);for(let n=2;n<8;n++){const a=parseInt(t[n],16);e+=a}A[(e+10).toString()]+=1}Ge.log("Total:",A)},getRarity(e){let t="Common",n="C";switch(e){case 4:case 5:case 6:case 7:n="UC";break;case 8:case 9:n="R";break;case 10:n="RR";break;case 11:n="RRR";break;case 12:n="SR";break;case 13:n="HR";break;case 14:n="UR";break;case 15:n="SSR";break;default:break}switch(e){case 4:case 5:case 6:case 7:t="Uncommon";break;case 8:case 9:case 10:case 11:t="Rare";break;case 12:case 13:case 14:case 15:t="Epic";break;default:break}return{rarity:t,short:n}},initDate(){localStorage.getItem("userGems")&&(Object.assign(t.value,JSON.parse(localStorage.getItem("userGems")||"")),t.value.sort((function(e,t){return e.nft<t.nft?1:e.nft>t.nft?-1:0})))}}},beforeMount(){this.initDate(),this.initGame(),this.getUserGems(),this.updateTree(!1)}});var ze=n(11639),Ne=n(69885),Re=n(89800),Ue=n(84106),Ae=n(63190),De=n(57691),Ze=n(68879),Me=n(32074),Pe=n(44458),Qe=n(61357),$e=n(90136),je=n(11821),Oe=n(8225),Ve=n(46017),Ee=n(21992),Fe=n(8289),Je=n(62146),Be=n(69984),Ke=n.n(Be);const Ye=(0,ze.Z)(He,[["render",pe],["__scopeId","data-v-6bae030f"]]),Le=Ye;Ke()(He,"components",{QPage:Ne.Z,QTabPanels:Re.Z,QTabPanel:Ue.Z,QCardSection:Ae.Z,QChip:De.Z,QBtn:Ze.Z,QDialog:Me.Z,QCard:Pe.Z,QAvatar:Qe.Z,QSpace:$e.Z,QCardActions:je.Z,QStepper:Oe.Z,QStep:Ve.Z,QStepperNavigation:Ee.Z,QLinearProgress:Fe.Z}),Ke()(He,"directives",{ClosePopup:Je.Z})},72593:e=>{e.exports=JSON.parse('[{"inputs":[{"internalType":"address","name":"newGame","type":"address"}],"name":"addGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gem1","type":"uint256"},{"internalType":"uint256","name":"gem2","type":"uint256"}],"name":"combineGem","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"gem","type":"address"},{"internalType":"address","name":"rand","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"newGame","type":"address"}],"name":"GameAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"removedGame","type":"address"}],"name":"GameRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"from1","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"from2","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"success","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"gemId","type":"uint256"}],"name":"GemCombine","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"from1","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"from2","type":"uint256"},{"indexed":false,"internalType":"bool","name":"success","type":"bool"},{"indexed":false,"internalType":"uint256","name":"gemId","type":"uint256"},{"indexed":false,"internalType":"string","name":"uri","type":"string"}],"name":"GemSettled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[{"internalType":"address","name":"game","type":"address"}],"name":"removeGame","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_contract","type":"address"}],"name":"setGem","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"requestId","type":"bytes32"},{"internalType":"uint256","name":"randomness","type":"uint256"}],"name":"settleRand","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"toggleGameIsLive","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"games","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"who","type":"address"}],"name":"isGame","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}]')}}]);
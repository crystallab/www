"use strict";(self["webpackChunkcrystal_dapp"]=self["webpackChunkcrystal_dapp"]||[]).push([[479],{54209:(e,t,o)=>{o.r(t),o.d(t,{default:()=>le});var l=o(59835),n=o(86970);const a=e=>((0,l.dD)("data-v-c9feff68"),e=e(),(0,l.Cn)(),e),r={class:"q-pa-md",style:{"max-width":"1439px"}},s=a((()=>(0,l._)("div",{class:"text-h6 text-center"},"Comming Soon...",-1))),i=a((()=>(0,l._)("br",null,null,-1))),c={class:"row items-center justify-evenly"},u={class:"gem-box row items-center justify-evenly"},f=a((()=>(0,l._)("div",{class:"text-h6"},[(0,l._)("i",{class:"las la-plus"})],-1))),m={class:"gem-box row items-center justify-evenly"},d=a((()=>(0,l._)("div",{class:"text-h6"},[(0,l._)("i",{class:"las la-plus"})],-1))),v={class:"gem-box row items-center justify-evenly"},p=a((()=>(0,l._)("div",{class:"row items-center justify-evenly"},[(0,l._)("i",{class:"las la-angle-double-down"})],-1))),w={class:"row items-center justify-evenly"},y=a((()=>(0,l._)("br",null,null,-1))),g=a((()=>(0,l._)("div",{class:"text-center"},null,-1))),h=a((()=>(0,l._)("br",null,null,-1))),b=(0,l.Uk)(" Combine "),k=a((()=>(0,l._)("span",{class:"text-h6 q-ml-sm"},"Incorrect blockchain",-1))),_=a((()=>(0,l._)("span",{class:"q-ml-sm"},"You are currently not connected to the correct network.",-1))),G=(0,l.Uk)(" Choose a Target "),q=["onClick"],x={class:"gem-count text-center text-bold"};function C(e,t,o,a,C,I){const S=(0,l.up)("CrystalGem"),W=(0,l.up)("q-btn"),N=(0,l.up)("q-tab-panel"),T=(0,l.up)("q-tab-panels"),U=(0,l.up)("nft-menu"),Z=(0,l.up)("q-avatar"),H=(0,l.up)("q-space"),D=(0,l.up)("q-card-section"),P=(0,l.up)("q-card-actions"),j=(0,l.up)("q-card"),Q=(0,l.up)("q-dialog"),A=(0,l.up)("q-page"),z=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.j4)(A,{class:"row items-center justify-evenly bg-pic",style:{"padding-top":"58px"}},{default:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l.Wm)(T,{class:"",flat:"","model-value":"crafting",animated:""},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{class:"",name:"crafting"},{default:(0,l.w5)((()=>[s,i,(0,l._)("div",c,[(0,l._)("div",u,[e.fromGem1?((0,l.wg)(),(0,l.iD)("div",{key:e.fromGem1},[(0,l.Wm)(S,{nft:1,level:e.fromGem1.level,color:e.fromGem1.color,quality:e.fromGem1.quality,scale:e.fromGem1.scale,size:36,detail:!0},null,8,["level","color","quality","scale"])])):(0,l.kq)("",!0)]),f,(0,l._)("div",m,[e.fromGem2?((0,l.wg)(),(0,l.iD)("div",{key:e.fromGem2},[(0,l.Wm)(S,{nft:2,level:e.fromGem2.level,color:e.fromGem2.color,quality:e.fromGem2.quality,scale:e.fromGem2.scale,size:36,detail:!0},null,8,["level","color","quality","scale"])])):(0,l.kq)("",!0)]),d,(0,l._)("div",v,[e.fromGem3?((0,l.wg)(),(0,l.iD)("div",{key:e.fromGem3},[(0,l.Wm)(S,{nft:3,level:e.fromGem3.level,color:e.fromGem3.color,quality:e.fromGem3.quality,scale:e.fromGem3.scale,size:36,detail:!0},null,8,["level","color","quality","scale"])])):(0,l.kq)("",!0)])]),p,(0,l._)("div",w,[(0,l._)("div",{class:"gem-box row items-center justify-evenly",onClick:t[0]||(t[0]=t=>e.updateTree())},[e.toCombineGem?((0,l.wg)(),(0,l.iD)("div",{key:e.toCombineGem},[(0,l.Wm)(S,{nft:1,level:e.toCombineGem.level,color:e.toCombineGem.color,quality:32,scale:1,size:45},null,8,["level","color"])])):(0,l.kq)("",!0)])]),y,g,h,(0,l.Wm)(W,{disable:"",unelevated:"",color:"primary",class:"min-width-320","no-caps":""},{default:(0,l.w5)((()=>[b])),_:1})])),_:1})])),_:1})]),(0,l.Wm)(U),(0,l.Wm)(Q,{modelValue:e.switchNet,"onUpdate:modelValue":t[2]||(t[2]=t=>e.switchNet=t),persistent:""},{default:(0,l.w5)((()=>[(0,l.Wm)(j,{class:"bg-glass"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{class:"row items-center q-pb-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,{icon:"signal_wifi_off",color:"primary","text-color":"white",size:"xs"}),k,(0,l.Wm)(H),(0,l.wy)((0,l.Wm)(W,{icon:"close",flat:"",round:"",dense:""},null,512),[[z]])])),_:1}),(0,l.Wm)(D,{class:"row items-center"},{default:(0,l.w5)((()=>[_])),_:1}),(0,l.Wm)(P,{align:"right"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(W,{class:"full-width",label:"Switch",color:"primary",onClick:t[1]||(t[1]=t=>e.switchNetwork(e.netIndex))},null,512),[[z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(Q,{modelValue:e.chooseTar,"onUpdate:modelValue":t[3]||(t[3]=t=>e.chooseTar=t)},{default:(0,l.w5)((()=>[(0,l.Wm)(j,{class:"bg-glass"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{class:"row items-center q-pb-none"},{default:(0,l.w5)((()=>[G])),_:1}),(0,l.Wm)(D,{class:"row items-center q-pb-none"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.canCombineGems,(t=>((0,l.wg)(),(0,l.iD)("div",{key:t},[(0,l._)("div",{class:"gem-box row items-center justify-evenly",onClick:o=>e.setToCombine(t,0)},[(0,l.Wm)(S,{nft:0,level:t.level,color:t.color,quality:100,scale:.8,size:45},null,8,["level","color","scale"])],8,q),(0,l._)("div",x,"x "+(0,n.zw)(t.text),1)])))),128))])),_:1}),(0,l.Wm)(D,{class:"row items-center q-pb-none"})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var I=o(60499),S=o(19302),W=o(65457),N=o(44320),T=o(82108),U=o(85990),Z=o(88576),H=o.n(Z),D=o(17779),P=function(e,t,o,l){function n(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function r(e){try{i(l.next(e))}catch(t){a(t)}}function s(e){try{i(l["throw"](e))}catch(t){a(t)}}function i(e){e.done?o(e.value):n(e.value).then(r,s)}i((l=l.apply(e,t||[])).next())}))},j=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,o=e[Symbol.asyncIterator];return o?o.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},l("next"),l("throw"),l("return"),t[Symbol.asyncIterator]=function(){return this},t);function l(o){t[o]=e[o]&&function(t){return new Promise((function(l,a){t=e[o](t),n(l,a,t.done,t.value)}))}}function n(e,t,o,l){Promise.resolve(l).then((function(t){e({value:t,done:o})}),t)}};const Q=o(10875);function A(e){D.log("Switch network: ",(0,U.v)().networks[e].name,(0,U.v)().networks[e].id),(0,U.v)().initWeb3(e)}const z={title:"Crystal - Crafting"},R=(0,l.aZ)({name:"CraftingPage",components:{NftMenu:N.Z,CrystalGem:T.Z},setup(){const e=(0,S.Z)();e.dark.set(!0),(0,W.Z)(z);const t=(0,I.iH)([]),o=(0,I.iH)([]),l=(0,I.iH)([]),n=(0,I.iH)(),a=(0,I.iH)(),r=(0,I.iH)(),s=(0,I.iH)();let i=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],c=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];const u=e=>new Promise((t=>setTimeout(t,e))),f=(0,I.iH)(!1),m=(0,I.iH)(!1),d=(0,I.iH)(0),v=(0,I.iH)("0x30a8C517b35e7D635f77AaeeBb0C704015dFaa6A");function p(){return P(this,void 0,void 0,(function*(){const e=yield(0,U.v)().web3.eth.net.getId().then((e=>(D.log(e),e))).catch((e=>(D.log("checkNetwork: ",e),-1)));return e}))}function w(e){return P(this,void 0,void 0,(function*(){const t=(0,U.v)().networks[e].id,o=(0,U.v)().networks[e].name,l=(0,U.v)().networks[e].tokenName,n=(0,U.v)().networks[e].symbol,a=(0,U.v)().networks[e].rpcUrl,r=(0,U.v)().networks[e].explorer,s="0x"+t.toString(16);if("undefined"!==typeof window.ethereum)try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:s}]}),location.reload()}catch(i){if(D.log(i),4902===i.code){D.log("Add Chain");try{yield window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:s,chainName:o,nativeCurrency:{name:l,symbol:n,decimals:18},rpcUrls:[a],blockExplorerUrls:[r]}]}),location.reload()}catch(c){alert(c.message)}}else alert(i.message)}}))}function y(e){return P(this,void 0,void 0,(function*(){D.log("reSyncURI:",e);const t=yield H().Web3API.token.reSyncMetadata({chain:"polygon",address:v.value,token_id:e,flag:"uri"});D.log("reSyncURI resp:",e,t)}))}function g(e){var t,o,l,n;return P(this,void 0,void 0,(function*(){try{for(t=j(e);o=yield t.next(),!o.done;){const e=o.value;yield u(1e3),yield y(e),yield h(e)}}catch(a){l={error:a}}finally{try{o&&!o.done&&(n=t.return)&&(yield n.call(t))}finally{if(l)throw l.error}}}))}function h(e){return P(this,void 0,void 0,(function*(){D.log("getGemURI id:",e);const l=(0,U.v)().web3Instance,n=new l.eth.Contract(Q,v.value);n.methods.tokenURI(e).call().then((function(l){D.log("getGemURI: ",l);const n=parseInt(e),a=JSON.parse(l),r=(0,U.v)().web3.utils.toHex(a.properties);let s=10,i=10;for(let e=2;e<14;e++){const t=parseInt(r[e],16);e<8?s+=t:e<14&&(i+=t)}const c={nft:n,level:a.level,color:a.color,quality:s,scale:i/100,properties:r,text:""};for(let e=0;e<o.value.length;e++){const t=o.value[e];t.nft==n&&o.value.splice(e,1)}k(c,n),localStorage.setItem("userGems",JSON.stringify(t.value))})).catch((function(e){D.log("getGemURI: ",e)}))}))}function b(){return P(this,void 0,void 0,(function*(){const e="https://uf9sagja413n.usemoralis.com:2053/server",l="Kq3K4FzmThqNQqDX2APLDoBueUYy8IA1u4eBJTBp";yield H().start({serverUrl:e,appId:l});const n=(0,U.v)().account,a=(0,U.v)().web3Instance;if(!a.utils.isAddress(n))return alert("Need Connect Wallet!"),void D.log("Not Address:",n);try{const e=yield H().Web3API.account.getNFTsForContract({chain:"polygon",address:n,token_address:v.value});D.log(e.result);const l=e.result||[];_(l);let a=[];o.value=[],l.forEach((e=>{const l=parseInt(e.token_id);if(e.token_uri){const t=JSON.parse(e.token_uri),o=(0,U.v)().web3.utils.toHex(t.properties);let n=10,a=10;for(let e=2;e<14;e++){const t=parseInt(o[e],16);e<8?n+=t:e<14&&(a+=t)}const r={nft:l,level:t.level,color:t.color,quality:n,scale:a/100,properties:o,text:""};k(r,l)}else{const n={nft:l,level:8,color:0,quality:10,scale:1,properties:"0xffffffffffff",text:""};a.push(e.token_id);let r=!1;for(let e=0;e<t.value.length;e++){const o=t.value[e];if(o.nft==l){r=!0;break}}r||(o.value.unshift(n),D.log(n))}})),g(a),localStorage.setItem("userGems",JSON.stringify(t.value))}catch(r){D.log(r)}}))}function k(e,o){let l=!1;for(let n=0;n<t.value.length;n++){const e=t.value[n];if(e.nft==o){l=!0;break}}l||(t.value.unshift(e),D.log(e))}function _(e){for(let o=0;o<t.value.length;o++){const l=t.value[o];let n=!1;for(let t=0;t<e.length;t++){const o=e[t].token_id;if(o==l.nft){n=!0;break}}n||t.value.splice(o,1)}}function G(){n.value=void 0,a.value=void 0,r.value=void 0,s.value=void 0,l.value=[];for(let e=0;e<6;e++)for(let t=0;t<16;t++)i[e][t]=0;for(let e=0;e<t.value.length;e++){const o=t.value[e],l=o.color,n=o.level;i[l][n]+=1}D.log("gemTree:",i);for(let e=0;e<6;e++)for(let t=0;t<15;t++)if(i[e][t]>=3){const o=Math.floor(i[e][t]/3);c[e][t+1]=o;const n={nft:0,level:t+1,color:e,quality:100,scale:1,properties:"0xffffffffffff",text:o.toString()};l.value.push(n)}D.log("combineTree:",c),D.log("Can combine:",l.value),m.value=!0}function q(e,t){switch(t){case 0:s.value=e;break;case 1:n.value=e;break;case 2:a.value=e;break;case 3:r.value=e;break;default:break}m.value=!1}let x={};for(let C=0;C<101;C++)x[C.toString()]=0;return{gemNftContract:v,netIndex:d,switchNet:f,chooseTar:m,userGems:t,newGems:o,canCombineGems:l,fromGem1:n,fromGem2:a,fromGem3:r,toCombineGem:s,gemTree:i,combineTree:c,checkNetwork:p,switchNetwork:w,getUserGems:b,updateTree:G,setToCombine:q,initGame(){return P(this,void 0,void 0,(function*(){let e=new URLSearchParams(window.location.search),t=e.get("ref");D.log(t||"No Ref");const o=d.value;A(o);const l=yield p();if(l!=(0,U.v)().networks[o].id)return D.log(l,"!=",(0,U.v)().networks[o].id),void(f.value=!0)}))},test(){for(let e=0;e<1e3;e++){let e=0,t=(0,U.v)().web3.utils.randomHex(3);for(let o=2;o<8;o++){const l=parseInt(t[o],16);e+=l}x[(e+10).toString()]+=1}D.log("Total:",x)},initDate(){localStorage.getItem("userGems")&&(Object.assign(t.value,JSON.parse(localStorage.getItem("userGems")||"")),t.value.sort((function(e,t){return e.nft<t.nft?1:e.nft>t.nft?-1:0})))}}},beforeMount(){this.initDate(),this.initGame(),this.getUserGems()}});var J=o(11639),O=o(69885),V=o(89800),B=o(84106),E=o(68879),F=o(32074),M=o(44458),K=o(63190),Y=o(61357),L=o(90136),X=o(11821),$=o(62146),ee=o(69984),te=o.n(ee);const oe=(0,J.Z)(R,[["render",C],["__scopeId","data-v-c9feff68"]]),le=oe;te()(R,"components",{QPage:O.Z,QTabPanels:V.Z,QTabPanel:B.Z,QBtn:E.Z,QDialog:F.Z,QCard:M.Z,QCardSection:K.Z,QAvatar:Y.Z,QSpace:L.Z,QCardActions:X.Z}),te()(R,"directives",{ClosePopup:$.Z})}}]);
(self["webpackChunkcrystal_dapp"]=self["webpackChunkcrystal_dapp"]||[]).push([[704],{79390:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>le});var o=l(59835),n=l(86970);const a=e=>((0,o.dD)("data-v-40c1465b"),e=e(),(0,o.Cn)(),e),s={class:"q-pa-md",style:{"max-width":"1439px"}},r={style:{height:"36px"}},i={class:"float-left"},c={class:"float-right"},u={key:0,class:"row content-start min-width-320 gem-box"},d=["onClick"],f={class:"my-table-details",style:{"padding-left":"0px"}},m=["onClick"],p={class:"inline"},w={class:"my-table-details"},v={class:"my-table-details"},h=a((()=>(0,o._)("span",{class:"text-h6 q-ml-sm"},"Incorrect blockchain",-1))),g=a((()=>(0,o._)("span",{class:"q-ml-sm"},"You are currently not connected to the correct network.",-1)));function y(e,t,l,a,y,b){const k=(0,o.up)("q-icon"),_=(0,o.up)("q-btn-toggle"),q=(0,o.up)("q-btn"),S=(0,o.up)("CrystalGem"),I=(0,o.up)("q-th"),x=(0,o.up)("q-tr"),C=(0,o.up)("q-td"),W=(0,o.up)("q-table"),G=(0,o.up)("q-card"),N=(0,o.up)("q-tab-panel"),Z=(0,o.up)("q-tab-panels"),Q=(0,o.up)("nft-menu"),U=(0,o.up)("q-avatar"),D=(0,o.up)("q-space"),T=(0,o.up)("q-card-section"),P=(0,o.up)("q-card-actions"),A=(0,o.up)("q-dialog"),H=(0,o.up)("q-page"),M=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(H,{class:"row items-center justify-evenly bg-pic",style:{"padding-top":"58px"}},{default:(0,o.w5)((()=>[(0,o._)("div",s,[(0,o.Wm)(Z,{class:"bg-none",flat:"","model-value":"collection",animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(N,{name:"collection",class:"q-pa-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(G,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",i,[(0,o.Wm)(_,{modelValue:e.isStashGrid,"onUpdate:modelValue":t[0]||(t[0]=t=>e.isStashGrid=t),flat:"",dense:"","toggle-color":"white",color:"grey",options:[{value:!0,slot:"one"},{value:!1,slot:"two"}]},{one:(0,o.w5)((()=>[(0,o.Wm)(k,{right:"",name:"view_module"})])),two:(0,o.w5)((()=>[(0,o.Wm)(k,{right:"",name:"view_list"})])),_:1},8,["modelValue"])]),(0,o._)("div",c,[(0,o.Wm)(q,{flat:"",round:"",dense:"",color:"white",icon:"las la-sync",onClick:t[1]||(t[1]=t=>e.getUserGems())})])]),e.isStashGrid?((0,o.wg)(),(0,o.iD)("div",u,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.newGems,(l=>((0,o.wg)(),(0,o.iD)("div",{class:"gem-in-box",key:l,onClick:t[2]||(t[2]=t=>e.getUserGems())},[(0,o.Wm)(S,{nft:l.nft,level:l.level,color:l.color,quality:l.quality,text:"?",scale:l.scale,newGem:!0,size:50,detail:!1},null,8,["nft","level","color","quality","scale"])])))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.userGems,(t=>((0,o.wg)(),(0,o.iD)("div",{class:"gem-in-box",key:t,onClick:l=>e.gemSelected(t.nft)},[(0,o.Wm)(S,{nft:t.nft,level:t.level,color:t.color,quality:t.quality,scale:t.scale,size:50,detail:!0},null,8,["nft","level","color","quality","scale"])],8,d)))),128))])):((0,o.wg)(),(0,o.j4)(W,{key:1,dense:e.$q.screen.lt.sm,"virtual-scroll":"","rows-per-page-options":[12],class:"my-sticky-header-table bg-none",rows:e.userGems,columns:e.gemColumns,"row-key":"nft",style:{"text-shadow":"#000 1px 0 10px"}},{header:(0,o.w5)((t=>[(0,o.Wm)(x,{props:t},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.cols,(l=>((0,o.wg)(),(0,o.j4)(I,{key:l.name,props:t,class:"text-primary text-justify"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(""==l.label?"":e.$t("gems."+l.label)),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),"body-cell-nft":(0,o.w5)((t=>[(0,o.Wm)(C,{props:t},{default:(0,o.w5)((()=>[(0,o._)("div",f,[(0,o._)("div",{class:"inline",style:{width:"55px"},onClick:l=>e.gemSelected(t.row.nft)},[(0,o.Wm)(S,{nft:t.row.nft,level:t.row.level,color:t.row.color,quality:t.row.quality,scale:t.row.scale,size:50,detail:!0,showName:!0},null,8,["nft","level","color","quality","scale"])],8,m),(0,o._)("div",p,(0,n.zw)(e.$t("gems.levels."+t.row.level.toString())+e.$t("gems.names."+t.row.color.toString())),1)])])),_:2},1032,["props"])])),"body-cell-scale":(0,o.w5)((e=>[(0,o.Wm)(C,{props:e},{default:(0,o.w5)((()=>[(0,o._)("div",w,(0,n.zw)(parseInt(100*e.row.scale)),1)])),_:2},1032,["props"])])),"body-cell-level":(0,o.w5)((e=>[(0,o.Wm)(C,{props:e},{default:(0,o.w5)((()=>[(0,o._)("div",v,(0,n.zw)(parseInt(4*e.row.level+10)),1)])),_:2},1032,["props"])])),_:1},8,["dense","rows","columns"]))])),_:1})])),_:1})])),_:1})]),(0,o.Wm)(Q),(0,o.Wm)(A,{modelValue:e.switchNet,"onUpdate:modelValue":t[4]||(t[4]=t=>e.switchNet=t),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(G,{class:"bg-glass"},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{class:"row items-center q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(U,{icon:"signal_wifi_off",color:"primary","text-color":"white",size:"xs"}),h,(0,o.Wm)(D),(0,o.wy)((0,o.Wm)(q,{icon:"close",flat:"",round:"",dense:""},null,512),[[M]])])),_:1}),(0,o.Wm)(T,{class:"row items-center"},{default:(0,o.w5)((()=>[g])),_:1}),(0,o.Wm)(P,{align:"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(q,{class:"full-width",label:"Switch",color:"primary",onClick:t[3]||(t[3]=t=>e.switchNetwork(e.netIndex))},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var b=l(60499),k=l(19302),_=l(65457),q=l(52074),S=l(82646),I=l(85990),x=l(88576),C=l.n(x),W=l(17779),G=function(e,t,l,o){function n(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,a){function s(e){try{i(o.next(e))}catch(t){a(t)}}function r(e){try{i(o["throw"](e))}catch(t){a(t)}}function i(e){e.done?l(e.value):n(e.value).then(s,r)}i((o=o.apply(e,t||[])).next())}))},N=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,l=e[Symbol.asyncIterator];return l?l.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(l){t[l]=e[l]&&function(t){return new Promise((function(o,a){t=e[l](t),n(o,a,t.done,t.value)}))}}function n(e,t,l,o){Promise.resolve(o).then((function(t){e({value:t,done:l})}),t)}};function Z(e){W.log("Switch network: ",(0,I.v)().networks[e].name,(0,I.v)().networks[e].id),(0,I.v)().initWeb3(e)}const Q={title:"Crystal - NFT"},U=[{name:"nft",label:"itemName",field:"nft",align:"left",sortable:!0},{name:"quality",label:"quality",field:"quality",align:"center",sortable:!0},{name:"scale",label:"weight",field:"scale",align:"center",sortable:!0},{name:"level",label:"level",field:"level",align:"center",sortable:!0}],D=(0,o.aZ)({name:"NftListPage",components:{CrystalGem:q.Z,NftMenu:S.Z},setup(){const e=(0,k.Z)();e.dark.set(!0),(0,_.Z)(Q);const t=e=>new Promise((t=>setTimeout(t,e))),l=(0,b.iH)(!1),o=(0,b.iH)(0),n=(0,b.iH)("0xf18a1FEf4823Ce5ddb20B71D82FA06470DF84B17"),a=(0,b.iH)("0x30a8C517b35e7D635f77AaeeBb0C704015dFaa6A"),s=(0,b.iH)([]),r=(0,b.iH)([]),i=(0,b.iH)([]);let c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function u(){return G(this,void 0,void 0,(function*(){const e=yield(0,I.v)().web3.eth.net.getId().then((e=>(W.log(e),e))).catch((e=>(W.log("checkNetwork: ",e),-1)));return e}))}function d(e){return G(this,void 0,void 0,(function*(){const t=(0,I.v)().networks[e].id,l=(0,I.v)().networks[e].name,o=(0,I.v)().networks[e].tokenName,n=(0,I.v)().networks[e].symbol,a=(0,I.v)().networks[e].rpcUrl,s=(0,I.v)().networks[e].explorer,r="0x"+t.toString(16);if("undefined"!==typeof window.ethereum)try{yield window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:r}]}),location.reload()}catch(i){if(W.log(i),4902===i.code){W.log("Add Chain");try{yield window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:r,chainName:l,nativeCurrency:{name:o,symbol:n,decimals:18},rpcUrls:[a],blockExplorerUrls:[s]}]}),location.reload()}catch(c){alert(c.message)}}else alert(i.message)}}))}function f(e){return G(this,void 0,void 0,(function*(){W.log("reSyncURI:",e);const t=yield C().Web3API.token.reSyncMetadata({chain:"polygon",address:a.value,token_id:e,flag:"uri"});W.log("reSyncURI resp:",e,t)}))}function m(e){var l,o,n,a;return G(this,void 0,void 0,(function*(){try{for(l=N(e);o=yield l.next(),!o.done;){const e=o.value;yield t(1e3),yield f(e)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(a=l.return)&&(yield a.call(l))}finally{if(n)throw n.error}}}))}function p(){return G(this,void 0,void 0,(function*(){const e="https://uf9sagja413n.usemoralis.com:2053/server",t="Kq3K4FzmThqNQqDX2APLDoBueUYy8IA1u4eBJTBp";yield C().start({serverUrl:e,appId:t});const l=(0,I.v)().account;try{const e=yield C().Web3API.account.getNFTsForContract({chain:"polygon",address:l,token_address:a.value}),t=e.result||[];v(t);let o=[];i.value=[],t.forEach((e=>{if(e.token_uri){const t=JSON.parse(e.token_uri),l=e.token_id,o=(0,I.v)().web3.utils.toHex(t.properties);let n=10,a=10;for(let e=2;e<14;e++){const t=parseInt(o[e],16);e<8?n+=t:e<14&&(a+=t)}const s={nft:l,level:t.level,color:t.color,quality:n,scale:a/100,properties:o};w(s,l)}else{const t={nft:e.token_id,level:8,color:0,quality:10,scale:1,properties:"0xffffffffffff"};o.push(e.token_id),i.value.unshift(t)}})),m(o),localStorage.setItem("userGems",JSON.stringify(r.value))}catch(o){W.log(o)}}))}function w(e,t){let l=!1;for(let o=0;o<r.value.length;o++){const e=r.value[o];if(e.nft==t){l=!0;break}}l||(r.value.unshift(e),W.log(e))}function v(e){for(let t=0;t<r.value.length;t++){const l=r.value[t];let o=!1;for(let t=0;t<e.length;t++){const n=e[t].token_id;if(n==l.nft){o=!0;break}}o||r.value.splice(t,1)}}function h(){r.value=[];for(let e=0;e<96;e++){const t={nft:e.toString(),level:e%16,color:Math.floor(e/16),quality:Math.floor(32*Math.random())+1,scale:.64,properties:"0x123123123123123123123"};r.value.push(t)}}function g(){let e=0;for(let l=0;l<1e6;l++){let t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);t=Math.floor(t/10);let l=0;for(let o=0;o<16;o++){if(t%2==0){l=o,e++;break}t=Math.floor(t/10)}c[l]++}W.log("gems:",c);let t=0;for(let l=0;l<c.length;l++){const e=c[l];t+=e}W.log(e,t)}return{isStashGrid:(0,b.iH)(!0),netIndex:o,switchNet:l,memberContract:n,gemNftContract:a,sample:s,userGems:r,newGems:i,gemColumns:U,checkNetwork:u,switchNetwork:d,reSyncURI:f,reSyncURIs:m,getUserGems:p,addGem:w,compareGem:v,setSample:h,test:g,initGame(){return G(this,void 0,void 0,(function*(){let e=new URLSearchParams(window.location.search),t=e.get("ref");W.log(t||"No Ref");const n=o.value;Z(n);const a=yield u();if(a!=(0,I.v)().networks[n].id)return W.log(a,"!=",(0,I.v)().networks[n].id),void(l.value=!0)}))},updateInputs(e){W.log("updateInputs: ",e)},gemSelected(e){W.log("Selected: ",e)},initDate(){localStorage.getItem("userGems")&&(Object.assign(r.value,JSON.parse(localStorage.getItem("userGems")||"")),r.value.sort((function(e,t){return parseInt(e.nft)<parseInt(t.nft)?1:parseInt(e.nft)>parseInt(t.nft)?-1:0})))}}},beforeMount(){this.initDate(),this.initGame(),this.getUserGems()}});var T=l(11639),P=l(69885),A=l(89800),H=l(84106),M=l(44458),z=l(1389),E=l(22857),F=l(68879),B=l(8858),j=l(31233),R=l(21682),V=l(67220),K=l(32074),Y=l(63190),J=l(61357),O=l(90136),$=l(11821),L=l(62146),X=l(69984),ee=l.n(X);const te=(0,T.Z)(D,[["render",y],["__scopeId","data-v-40c1465b"]]),le=te;ee()(D,"components",{QPage:P.Z,QTabPanels:A.Z,QTabPanel:H.Z,QCard:M.Z,QBtnToggle:z.Z,QIcon:E.Z,QBtn:F.Z,QTable:B.Z,QTr:j.Z,QTh:R.Z,QTd:V.Z,QDialog:K.Z,QCardSection:Y.Z,QAvatar:J.Z,QSpace:O.Z,QCardActions:$.Z}),ee()(D,"directives",{ClosePopup:L.Z})},36563:()=>{},42480:()=>{},71156:()=>{}}]);